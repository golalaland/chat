<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Xixi Chat ðŸ’¸</title>
<link rel="icon" href="data:," />
<style>
:root{
  --bg:#000;
  --card:#111;
  --muted:#aaa;
  --accent:#FF1493;
  --glass:rgba(255,255,255,0.08);
}
body{
  margin:0;
  font-family:sans-serif;
  background:var(--bg);
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
#center{
  width:100%;
  max-width:480px;
  height:100%;
  display:flex;
  flex-direction:column;
  background:rgba(255,255,255,0.03);
  backdrop-filter:blur(12px);
  border-radius:16px;
  overflow:hidden;
  position:relative;
}
#messages{
  flex:1;
  overflow-y:auto;
  padding:8px;
  display:flex;
  flex-direction:column;
  gap:6px;
  border-radius:8px;
  background:#000;
  margin-bottom:4px;
  box-sizing:border-box;
  scroll-behavior:smooth;
}
.msg{
  background:var(--card);
  padding:8px 12px;
  border-radius:12px;
  max-width:80%;
}
.send-area{
  display:flex;
  align-items:center;
  gap:8px;
  background:var(--card);
  padding:10px;
  position:sticky;   /* anchored inside glass container */
  bottom:0;
  z-index:10;
  border-top:1px solid rgba(255,255,255,0.04);
  border-radius:999px;
  width:100%;
  box-sizing:border-box;
}
#msgInput{
  flex:1;
  padding:8px;
  border:none;
  outline:none;
  background:var(--glass);
  border-radius:999px;
  color:#fff;
}
button{
  background:var(--accent);
  border:none;
  color:#fff;
  padding:8px 14px;
  border-radius:999px;
  cursor:pointer;
}
</style>
</head>
<body>
  <div id="center">
    <div id="messages"></div>
    <div class="send-area">
      <input id="msgInput" placeholder="Type a message..." />
      <button id="sendBtn">Send</button>
      <button id="buzzBtn">Buzz</button>
    </div>
  </div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp, onSnapshot, orderBy, query } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

// Your Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDbKz4ef_eUDlCukjmnK38sOwueYuzqoao",
  authDomain: "metaverse-1010.firebaseapp.com",
  projectId: "metaverse-1010",
  storageBucket: "metaverse-1010.firebasestorage.app",
  messagingSenderId: "1044064238233",
  appId: "1:1044064238233:web:2fbdfb811cb0a3ba349608",
  measurementId: "G-S77BMC266C",
  databaseURL: "https://metaverse-1010-default-rtdb.firebaseio.com/"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Sign in with Google
const provider = new GoogleAuthProvider();
signInWithPopup(auth, provider).catch(err => console.error(err));

// Messages
const messagesRef = collection(db, "messages_livestreaming");

// Send message
async function sendMessage(text) {
  if (!text.trim()) return;
  await addDoc(messagesRef, {
    text,
    uid: auth.currentUser ? auth.currentUser.uid : "anon",
    createdAt: serverTimestamp()
  });
  document.getElementById("msgInput").value = "";
}

// Display messages
const q = query(messagesRef, orderBy("createdAt"));
onSnapshot(q, snapshot => {
  const msgs = document.getElementById("messages");
  msgs.innerHTML = "";
  snapshot.forEach(doc => {
    const div = document.createElement("div");
    div.className = "msg";
    div.textContent = doc.data().text;
    msgs.appendChild(div);
  });
  msgs.scrollTop = msgs.scrollHeight;
});

// Event listeners
document.getElementById("sendBtn").onclick = () => {
  sendMessage(document.getElementById("msgInput").value);
};
document.getElementById("msgInput").addEventListener("keydown", e => {
  if (e.key === "Enter") sendMessage(e.target.value);
});
document.getElementById("buzzBtn").onclick = () => {
  sendMessage("BUZZ!!! ðŸ””");
  fireConfetti();
};
</script>

<!-- Confetti -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
<script>
function fireConfetti() {
  var duration = 2 * 1000; // 2 seconds
  var end = Date.now() + duration;

  (function frame() {
    confetti({
      particleCount: 5,
      angle: 60,
      spread: 55,
      origin: { x: 0 }
    });
    confetti({
      particleCount: 5,
      angle: 120,
      spread: 55,
      origin: { x: 1 }
    });

    if (Date.now() < end) {
      requestAnimationFrame(frame);
    }
  })();
}
</script>
</body>
</html>