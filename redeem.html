<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VIP Invite</title>
<style>
body{
  margin:0;
  font-family:'Helvetica Neue',sans-serif;
  background:#000;
  color:#fff;
  text-align:center;
  display:flex;
  flex-direction:column;
  min-height:100vh;
}
h1{
  font-size:1.8rem;
  letter-spacing:2px;
  margin-top:20px;
  color:#ff66aa;
}
img#girlImage{
  width:100%;
  max-width:400px;
  height:auto;
  margin:0 auto 20px auto;
  border-radius:15px;
  object-fit:cover;
}
form{
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:0 20px;
  width:100%;
  max-width:350px;
  margin:0 auto;
}
label{
  align-self:flex-start;
  margin:5px 0 2px 0;
  font-size:0.9rem;
  color:#ccc;
}
input{
  width:100%;
  padding:12px;
  margin-bottom:10px;
  border-radius:10px;
  border:none;
  font-size:1rem;
}
input:focus{outline:none; box-shadow:0 0 10px #ff66aa;}
button{
  margin-top:15px;
  padding:12px 30px;
  font-size:1rem;
  font-weight:bold;
  color:#fff;
  border:none;
  border-radius:12px;
  cursor:pointer;
  transition:transform 0.2s,box-shadow 0.2s;
}
button:hover{
  transform:scale(1.05);
  box-shadow:0 0 15px #ff66aa;
}
#payBtn{
  background:linear-gradient(45deg,#ff66aa,#ff3399);
}
footer{
  margin-top:auto;
  padding:15px;
  background:#111;
  color:#888;
  font-size:0.9rem;
  display:flex;
  justify-content:center;
  gap:15px;
}
footer a{color:#66ccff; text-decoration:none;}
footer a:hover{text-decoration:underline;}
@media(max-width:400px){
  h1{font-size:1.6rem;}
  input{font-size:0.95rem;padding:10px;}
  button{font-size:0.95rem;padding:10px 25px;}
}
</style>
</head>
<body>

<h1 id="headerText">Join VIP Club – ₦2,999/week</h1>
<img src="https://via.placeholder.com/400x200" id="girlImage" alt="Girl Image">

<form id="vipForm">
  <label for="userName">Name</label>
  <input type="text" id="userName" placeholder="Enter your name" required>
  <label for="userEmail">Email</label>
  <input type="email" id="userEmail" placeholder="Enter your email" required>
  <button type="button" id="payBtn">Pay & Join VIP</button>
</form>

<footer>
  <a href="#">Terms</a>
  <a href="#">Privacy</a>
  <a href="#">Contact</a>
</footer>

<script src="https://www.gstatic.com/firebasejs/9.25.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.25.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.25.0/firebase-auth-compat.js"></script>
<script src="https://js.paystack.co/v1/inline.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDbKz4ef_eUDlCukjmnK38sOwueYuzqoao",
  authDomain: "metaverse-1010.firebaseapp.com",
  projectId: "metaverse-1010",
  storageBucket: "metaverse-1010.firebasestorage.app",
  messagingSenderId: "1044064238233",
  appId: "1:1044064238233:web:2fbdfb811cb0a3ba349608",
  measurementId: "G-S77BMC266C"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Get referral code from URL
const urlParams = new URLSearchParams(window.location.search);
const girlCode = urlParams.get('ref'); // links back to the inviting girl

// Optionally, fetch girl’s name & photo dynamically
if(girlCode){
  db.collection("girls").where("referralCode","==",girlCode).get().then(snapshot=>{
    if(!snapshot.empty){
      const data = snapshot.docs[0].data();
      document.getElementById("headerText").textContent = `Join ${data.name}'s VIP Club – ₦2,999/week`;
      document.getElementById("girlImage").src = data.photoURL || "https://via.placeholder.com/400x200";
    }
  });
}

// Paystack subscription
document.getElementById("payBtn").addEventListener("click", function(){
  const name = document.getElementById("userName").value;
  const email = document.getElementById("userEmail").value;
  const amount = 2999; // fixed weekly subscription

  if(!name || !email){
    alert("Please fill all fields correctly.");
    return;
  }

  let handler = PaystackPop.setup({
    key: "YOUR_PUBLIC_PAYSTACK_KEY", // replace with your Paystack public key
    email: email,
    amount: amount*100, // kobo
    currency: "NGN",
    metadata: {custom_fields:[{display_name:"Referral Code", variable_name:"referral", value:girlCode}]},
    callback: function(response){
      console.log("Payment success:", response.reference);
      // Record VIP user in Firestore
      db.collection("vipUsers").add({
        name:name,
        email:email,
        referredBy:girlCode || null,
        plan:"Weekly ₦2,999",
        reference:response.reference,
        timestamp:firebase.firestore.FieldValue.serverTimestamp()
      }).then(async()=>{
        if(girlCode){
          const girlQuery = await db.collection("girls").where("referralCode","==",girlCode).get();
          if(!girlQuery.empty){
            const girlDoc = girlQuery.docs[0];
            await girlDoc.ref.update({
              cashEarned: firebase.firestore.FieldValue.increment(amount)
            });
          }
        }
        alert("Subscription successful! Welcome to VIP.");
      }).catch(err=>{console.error(err); alert("Error saving subscription.");});
    },
    onClose: function(){
      alert("Subscription cancelled.");
    }
  });
  handler.openIframe();
});
</script>
</body>
</html>