<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cube Signup/Login</title>
<style>
  /* ===== Global ===== */
  body {
    margin: 0;
    font-family: 'Helvetica Neue', sans-serif;
    background: #000;
    color: #fff;
    text-align: center;
  }

  h1 {
    font-size: 3rem;
    letter-spacing: 5px;
    margin-top: 20px;
    color: #ff66aa;
  }

  h2 {
    font-size: 1.2rem;
    color: #ccc;
    margin-bottom: 20px;
  }

  img {
    width: 150px;
    height: 150px;
    border-radius: 20px;
    margin-bottom: 20px;
  }

  /* ===== Form ===== */
  form {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0 20px;
  }

  input {
    width: 100%;
    max-width: 300px;
    padding: 12px;
    margin: 8px 0;
    border-radius: 10px;
    border: none;
    font-size: 1rem;
  }

  input:focus {
    outline: none;
    box-shadow: 0 0 10px #ff66aa;
  }

  button {
    margin-top: 15px;
    padding: 12px 30px;
    font-size: 1rem;
    font-weight: bold;
    color: #fff;
    background: linear-gradient(45deg, #ff66aa, #6600ff);
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
  }

  button:hover {
    transform: scale(1.05);
    box-shadow: 0 0 15px #ff66aa;
  }

  /* ===== Dashboard Hive ===== */
  #hiveDashboard {
    position: relative;
    width: 90vw;
    max-width: 400px;
    height: 90vw;
    max-height: 400px;
    margin: 20px auto;
    border-radius: 50%;
    background: #111;
    border: 2px solid #333;
  }

  .circle {
    position: absolute;
    width: 70px;
    height: 70px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
    transition: transform 0.2s;
  }

  .circle:hover {
    transform: scale(1.2);
    box-shadow: 0 0 15px #ff66aa;
  }

  #mainGirl {
    background: linear-gradient(45deg, #ff66aa, #ff99cc);
  }

  .friendCircle {
    background: linear-gradient(45deg, #66ccff, #3399ff);
  }

  /* Responsive Text */
  @media (max-width: 400px) {
    h1 { font-size: 2.5rem; }
    h2 { font-size: 1rem; }
    input { font-size: 0.95rem; padding: 10px; }
    button { font-size: 0.95rem; padding: 10px 25px; }
  }
</style>
</head>
<body>

<h1>乂丨乂丨</h1>
<h2>Get paid hosting with CUBE</h2>

<!-- Placeholder Image -->
<img src="https://via.placeholder.com/150" alt="Placeholder Image">

<!-- Signup/Login Form -->
<form id="signupForm">
  <input type="text" id="name" placeholder="Name" required />
  <input type="date" id="dob" placeholder="DOB" required />
  <input type="tel" id="phone" placeholder="Phone Number" required />
  <input type="email" id="email" placeholder="Email Address" required />
  <input type="text" id="bankName" placeholder="Bank Name" required />
  <input type="text" id="accountNumber" placeholder="Account Number" required />
  <button type="submit" id="submitBtn">Sign Up / Login</button>
</form>

<!-- Dashboard -->
<div id="dashboard" style="display:none;">
  <h3>Welcome <span id="dashName"></span>!</h3>
  <p>Your referral link:</p>
  <input type="text" id="refLink" readonly style="width:80%; max-width:300px; margin-bottom:15px;">
  <button onclick="copyLink()">Copy Link</button>
  
  <p>Reward Balance: <span id="rewardBalance">0</span> ⭐</p>
  
  <h4>Your Hive:</h4>
  <div id="hiveDashboard">
    <div id="mainGirl" class="circle">Main Girl</div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.25.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.25.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.25.0/firebase-firestore-compat.js"></script>

<script>
  // ---------------- Firebase Config ----------------
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  function generateReferralCode(name) {
    const randomNum = Math.floor(1000 + Math.random() * 9000);
    const initials = name.slice(0,3).toUpperCase();
    return initials + randomNum;
  }

  function copyLink() {
    const copyText = document.getElementById("refLink");
    copyText.select();
    document.execCommand("copy");
    alert("Referral link copied!");
  }

  async function showDashboard(uid) {
    const docSnap = await db.collection("girls").doc(uid).get();
    if (!docSnap.exists()) return;
    const data = docSnap.data();

    document.getElementById("dashName").textContent = data.name;
    document.getElementById("refLink").value = `${window.location.origin}/signup.html?ref=${data.referralCode}`;
    document.getElementById("rewardBalance").textContent = data.rewardBalance || 0;

    const hive = document.getElementById("hiveDashboard");
    const mainGirlDiv = document.getElementById("mainGirl");
    mainGirlDiv.textContent = data.name;

    document.querySelectorAll(".friendCircle").forEach(el => el.remove());

    const friends = data.friends || [];
    const centerX = hive.offsetWidth / 2;
    const centerY = hive.offsetHeight / 2;
    const radius = centerX - 70;

    friends.forEach((friendId, index) => {
      const angle = (index / friends.length) * 2 * Math.PI;
      const x = centerX + radius * Math.cos(angle);
      const y = centerY + radius * Math.sin(angle);

      db.collection("girls").doc(friendId).get().then(friendDoc => {
        if (!friendDoc.exists) return;
        const fData = friendDoc.data();

        const friendDiv = document.createElement("div");
        friendDiv.className = "circle friendCircle";
        friendDiv.style.left = `${x - 35}px`;
        friendDiv.style.top = `${y - 35}px`;
        friendDiv.textContent = fData.name;

        hive.appendChild(friendDiv);
      });
    });

    document.getElementById("signupForm").style.display = "none";
    document.getElementById("dashboard").style.display = "block";
    document.getElementById("title").textContent = "Hive Dashboard";
  }

  document.getElementById("signupForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const name = document.getElementById("name").value;
    const dob = document.getElementById("dob").value;
    const phone = document.getElementById("phone").value;
    const email = document.getElementById("email").value;
    const bankName = document.getElementById("bankName").value;
    const accountNumber = document.getElementById("accountNumber").value;

    const urlParams = new URLSearchParams(window.location.search);
    const refCode = urlParams.get('ref');

    try {
      const tempPassword = "TempPass123!";
      let user;
      try {
        const userCredential = await auth.signInWithEmailAndPassword(email, tempPassword);
        user = userCredential.user;
        alert("Welcome back!");
      } catch(err) {
        if(err.code === "auth/user-not-found") {
          const userCredential = await auth.createUserWithEmailAndPassword(email, tempPassword);
          user = userCredential.user;

          let referralCode = generateReferralCode(name);
          let codeExists = await db.collection("girls").where("referralCode", "==", referralCode).get();
          while(!codeExists.empty) {
            referralCode = generateReferralCode(name);
            codeExists = await db.collection("girls").where("referralCode", "==", referralCode).get();
          }

          await db.collection("girls").doc(user.uid).set({
            name, dob, phone, email, bankName, accountNumber,
            referralCode,
            referredBy: refCode || null,
            friends: [],
            rewardBalance: 0,
            groupId: null
          });

          if(refCode) {
            const inviterQuery = await db.collection("girls").where("referralCode", "==", refCode).get();
            if(!inviterQuery.empty) {
              const inviterDoc = inviterQuery.docs[0];
              await inviterDoc.ref.update({
                friends: firebase.firestore.FieldValue.arrayUnion(user.uid)
              });
            }
          }
          alert("Signup successful!");
        } else throw err;
      }

      await showDashboard(user.uid);

    } catch(error) {
      console.error(error);
      alert("Error: " + error.message);
    }
  });
</script>
</body>
</html>