<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0; font-family: Arial, sans-serif;
      display: flex; height: 100vh; overflow: hidden;
      background: #f3f3f3;
    }
    /* Sidebar */
    .sidebar {
      width: 220px; background: #111; color: #fff;
      display: flex; flex-direction: column;
    }
    .sidebar h2 { padding: 20px; margin: 0; background:#222; font-size: 18px; }
    .sidebar button {
      padding: 12px; border: none; background: none; color: #ccc;
      text-align: left; cursor: pointer; transition: 0.2s;
    }
    .sidebar button:hover { background: #333; color:#fff; }

    /* Main */
    .main {
      flex: 1; padding: 20px; overflow-y: auto;
    }
    .view { display: none; }
    .card {
      background:#fff; padding:15px; margin-bottom:15px; border-radius:6px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    h3 { margin-top:0; }
    .table { width: 100%; border-collapse: collapse; }
    .table th, .table td { padding: 8px; border-bottom: 1px solid #ddd; }
    .action { padding:6px 10px; margin:2px; background:#007bff; color:#fff; border:none; cursor:pointer; border-radius:4px; }
    .action:hover { background:#0056b3; }
    input, select {
      padding:8px; margin:5px 0; width:100%; border:1px solid #ccc; border-radius:4px;
    }
    label { display:block; margin-top:5px; }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <h2>Admin Panel</h2>
    <button onclick="showView('view-rooms')">Rooms</button>
    <button onclick="showView('view-users')">Users</button>
    <button onclick="showView('view-shop')">Shop</button>
    <button onclick="showView('view-settings')">Settings</button>
    <button onclick="showView('view-logs')">Logs</button>
  </div>

  <!-- Main -->
  <div class="main">
    <!-- Rooms -->
    <div id="view-rooms" class="view">
      <div class="card">
        <h3>Room Controls</h3>
        <button class="action">Mute All</button>
        <button class="action">Slow Mode</button>
        <button class="action">Broadcast Announcement</button>
      </div>
    </div>

    <!-- Users -->
    <div id="view-users" class="view">
      <div class="card">
        <h3>Users</h3>
        <table class="table">
          <thead><tr><th>Name</th><th>Email</th><th>Host</th><th>Actions</th></tr></thead>
          <tbody id="userList"></tbody>
        </table>
      </div>
    </div>

    <!-- Shop -->
    <div id="view-shop" class="view">
      <div class="card">
        <h3>Shop Items</h3>
        <table class="table">
          <thead><tr><th>Item</th><th>Cost</th><th>Cash</th><th>Stock</th><th>Host Only</th><th>Actions</th></tr></thead>
          <tbody id="shopList"></tbody>
        </table>
      </div>

      <div class="card">
        <h3>Add / Edit Item</h3>
        <input id="productName" placeholder="Product Name">
        <input id="productImg" placeholder="Image URL">
        <input type="number" id="productCost" placeholder="Cost in Stars">
        <input type="number" id="productCashReward" placeholder="Cash Reward">
        <input type="number" id="productStock" placeholder="Available">
        <label><input type="checkbox" id="productHostOnly"> Host Only</label>
        <button class="action" id="saveProductBtn">Save Product</button>
      </div>

      <div class="card">
        <h3>Preview Mode</h3>
        <select id="shopViewMode">
          <option value="admin">Admin View</option>
          <option value="user">Normal User View</option>
          <option value="host">Host View</option>
        </select>
        <div id="shopPreview"></div>
      </div>
    </div>

    <!-- Settings -->
    <div id="view-settings" class="view">
      <div class="card"><h3>Global Settings</h3>
        <button class="action">Toggle Maintenance Mode</button>
        <button class="action">Reset Room Data</button>
      </div>
    </div>

    <!-- Logs -->
    <div id="view-logs" class="view">
      <div class="card">
        <h3>Action Logs</h3>
        <ul id="logList"></ul>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, setDoc, updateDoc, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDbKz4ef_eUDlCukjmnK38sOwueYuzqoao",
  authDomain: "metaverse-1010.firebaseapp.com",
  projectId: "metaverse-1010",
  storageBucket: "metaverse-1010.firebasestorage.app",
  messagingSenderId: "1044064238233",
  appId: "1:1044064238233:web:2fbdfb811cb0a3ba349608",
  measurementId: "G-S77BMC266C"
};

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ---------- Views ----------
    function showView(id) {
      document.querySelectorAll('.view').forEach(v => v.style.display='none');
      document.getElementById(id).style.display='block';
    }
    showView('view-rooms'); // default

    // ---------- Shop ----------
    const shopList = document.getElementById("shopList");
    const saveProductBtn = document.getElementById("saveProductBtn");

    async function loadShop() {
      shopList.innerHTML = '';
      const snap = await getDocs(collection(db, 'shopItems'));
      snap.forEach(docSnap => {
        const p = { id: docSnap.id, ...docSnap.data() };
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${p.name}</td>
          <td>${p.cost}</td>
          <td>${p.cashReward}</td>
          <td>${p.available}</td>
          <td>${p.hostOnly ? "✅" : "—"}</td>
          <td>
            <button class="action" onclick="editShopItem('${p.id}')">Edit</button>
            <button class="action" onclick="deleteShopItem('${p.id}')">Delete</button>
          </td>
        `;
        shopList.appendChild(row);
      });
    }
    window.loadShop = loadShop;
    loadShop();

    window.editShopItem = async (id) => {
      const snap = await getDoc(doc(db, 'shopItems', id));
      const p = snap.data();
      productName.value = p.name;
      productImg.value = p.img;
      productCost.value = p.cost;
      productCashReward.value = p.cashReward;
      productStock.value = p.available;
      productHostOnly.checked = p.hostOnly;
      saveProductBtn.onclick = async () => {
        await updateDoc(doc(db, 'shopItems', id), {
          name: productName.value,
          img: productImg.value,
          cost: Number(productCost.value),
          cashReward: Number(productCashReward.value),
          available: Number(productStock.value),
          hostOnly: productHostOnly.checked
        });
        loadShop(); alert('Updated!');
      }
    }

    window.deleteShopItem = async (id) => {
      await deleteDoc(doc(db, 'shopItems', id));
      loadShop();
    }

    saveProductBtn.onclick = async () => {
      await setDoc(doc(collection(db,'shopItems')), {
        name: productName.value,
        img: productImg.value,
        cost: Number(productCost.value),
        cashReward: Number(productCashReward.value),
        available: Number(productStock.value),
        hostOnly: productHostOnly.checked
      });
      loadShop(); alert('Added!');
    }

    // ---------- Shop Preview ----------
    const shopViewMode = document.getElementById("shopViewMode");
    const shopPreview = document.getElementById("shopPreview");

    async function renderShopPreview() {
      shopPreview.innerHTML = '';
      const mode = shopViewMode.value;
      const snap = await getDocs(collection(db,'shopItems'));
      snap.forEach(docSnap => {
        const p = docSnap.data();
        if (mode === 'user' && p.hostOnly) return;
        const div = document.createElement('div');
        div.innerHTML = `<b>${p.name}</b> (${p.cost}⭐) ${p.hostOnly ? "[Host]" : ""}`;
        shopPreview.appendChild(div);
      });
    }
    shopViewMode.onchange = renderShopPreview;
    renderShopPreview();
  </script>
</body>
</html>