<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<style>
:root {
  --bg: #f5f5f5;
  --card-bg: #fff;
  --accent: #ff33cc;
  --text: #000;
  --btn-bg: #ff33cc;
  --btn-text: #fff;
}
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
}
header {
  background: var(--card-bg);
  padding: 1rem 2rem;
  font-size: 1.8rem;
  font-weight: bold;
  border-bottom: 1px solid #ddd;
  text-align: center;
}
.container {
  display: flex;
  flex-wrap: wrap;
  padding: 1rem;
  gap: 1rem;
}
.card {
  background: var(--card-bg);
  padding: 1rem;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  flex: 1 1 300px;
}
.card h3 {
  margin-top: 0;
}
button {
  background: var(--btn-bg);
  color: var(--btn-text);
  border: none;
  padding: 0.5rem 1rem;
  font-weight: bold;
  border-radius: 6px;
  cursor: pointer;
  margin: 0.3rem 0;
  transition: background 0.2s;
}
button:hover {
  background: #ff66d6;
}
input, select {
  width: 100%;
  padding: 0.4rem;
  margin: 0.3rem 0 0.8rem 0;
  border-radius: 5px;
  border: 1px solid #ccc;
}
.user-list, .shop-list {
  max-height: 300px;
  overflow-y: auto;
}
.user-item, .shop-item {
  display: flex;
  justify-content: space-between;
  padding: 0.3rem 0;
  border-bottom: 1px solid #eee;
}
</style>
</head>
<body>

<header>üéõÔ∏è Admin Dashboard</header>

<div class="container">

  <!-- Rooms Control -->
  <div class="card">
    <h3>Rooms</h3>
    <select id="roomSelect"></select>
    <div>
      <button id="muteRoomBtn">Toggle Mute</button>
      <button id="slowChatBtn">Toggle Slow Chat</button>
    </div>
  </div>

  <!-- Users Management -->
  <div class="card">
    <h3>Users in Room</h3>
    <div class="user-list" id="userList"></div>
  </div>

  <!-- Shop Management -->
  <div class="card">
    <h3>Shop Items</h3>
    <div class="shop-list" id="shopList"></div>
    <h4>Add / Edit Item</h4>
    <input type="text" id="productName" placeholder="Product Name">
    <input type="text" id="productImg" placeholder="Image URL">
    <input type="number" id="productCost" placeholder="Cost in Stars">
    <input type="number" id="productCashReward" placeholder="Cash Reward">
    <input type="number" id="productStock" placeholder="Available">
    <button id="saveProductBtn">Save / Add Product</button>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, onSnapshot, collection, getDocs, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDbKz4ef_eUDlCukjmnK38sOwueYuzqoao",
  authDomain: "metaverse-1010.firebaseapp.com",
  projectId: "metaverse-1010",
  storageBucket: "metaverse-1010.appspot.com",
  messagingSenderId: "1044064238233",
  appId: "1:1044064238233:web:2fbdfb811cb0a3ba349608",
  databaseURL: "https://metaverse-1010-default-rtdb.firebaseio.com/"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ---------- DOM Refs ----------
const roomSelect = document.getElementById('roomSelect');
const muteRoomBtn = document.getElementById('muteRoomBtn');
const slowChatBtn = document.getElementById('slowChatBtn');
const userList = document.getElementById('userList');
const shopList = document.getElementById('shopList');
const productName = document.getElementById('productName');
const productImg = document.getElementById('productImg');
const productCost = document.getElementById('productCost');
const productCashReward = document.getElementById('productCashReward');
const productStock = document.getElementById('productStock');
const saveProductBtn = document.getElementById('saveProductBtn');

let currentRoomId = null;

// ---------- Rooms ----------
async function loadRooms() {
  const querySnap = await getDocs(collection(db, 'rooms'));
  roomSelect.innerHTML = '';
  querySnap.forEach(docSnap => {
    const room = { id: docSnap.id, ...docSnap.data() };
    const opt = document.createElement('option');
    opt.value = room.id;
    opt.textContent = room.name;
    roomSelect.appendChild(opt);
  });
  if(querySnap.size > 0) {
    currentRoomId = querySnap.docs[0].id;
    loadUsers(currentRoomId);
  }
}
roomSelect.onchange = () => {
  currentRoomId = roomSelect.value;
  loadUsers(currentRoomId);
}

// ---------- Users ----------
async function loadUsers(roomId) {
  userList.innerHTML = '';
  const querySnap = await getDocs(collection(db, 'users'));
  querySnap.forEach(docSnap => {
    const u = docSnap.data();
    const div = document.createElement('div');
    div.className = 'user-item';
    div.innerHTML = `<span>${u.chatId || u.email}</span>
                     <span>
                       <button onclick="kickUser('${docSnap.id}')">Kick</button>
                       <button onclick="banUser('${docSnap.id}')">Ban</button>
                     </span>`;
    userList.appendChild(div);
  });
}
window.kickUser = async (uid) => {
  const userRef = doc(db, 'users', uid);
  await updateDoc(userRef, { kicked: true });
  alert('User kicked!');
}
window.banUser = async (uid) => {
  const userRef = doc(db, 'users', uid);
  await updateDoc(userRef, { banned: true });
  alert('User banned!');
}

// ---------- Room Controls ----------
muteRoomBtn.onclick = async () => {
  if(!currentRoomId) return;
  const roomRef = doc(db, 'rooms', currentRoomId);
  const snap = await getDoc(roomRef);
  const isMuted = snap.data()?.globalMute || false;
  await updateDoc(roomRef, { globalMute: !isMuted });
  alert('Global Mute toggled: ' + !isMuted);
}
slowChatBtn.onclick = async () => {
  if(!currentRoomId) return;
  const roomRef = doc(db, 'rooms', currentRoomId);
  const snap = await getDoc(roomRef);
  const slow = snap.data()?.slowChat || false;
  await updateDoc(roomRef, { slowChat: !slow });
  alert('Slow Chat toggled: ' + !slow);
}

// ---------- Shop ----------
async function loadShop() {
  shopList.innerHTML = '';
  const querySnap = await getDocs(collection(db, 'shopItems'));
  querySnap.forEach(docSnap => {
    const p = { id: docSnap.id, ...docSnap.data() };
    const div = document.createElement('div');
    div.className = 'shop-item';
    div.innerHTML = `<span>${p.name} (${p.cost} ‚≠ê | ‚Ç¶${p.cashReward})</span>
                     <span>
                       <button onclick="editShopItem('${docSnap.id}')">Edit</button>
                       <button onclick="deleteShopItem('${docSnap.id}')">Delete</button>
                     </span>`;
    shopList.appendChild(div);
  });
}

window.editShopItem = async (id) => {
  const pRef = doc(db, 'shopItems', id);
  const snap = await getDoc(pRef);
  const data = snap.data();
  productName.value = data.name;
  productImg.value = data.img;
  productCost.value = data.cost;
  productCashReward.value = data.cashReward;
  productStock.value = data.available;
  saveProductBtn.onclick = async () => {
    await updateDoc(pRef, {
      name: productName.value,
      img: productImg.value,
      cost: Number(productCost.value),
      cashReward: Number(productCashReward.value),
      available: Number(productStock.value)
    });
    loadShop();
    alert('Item updated!');
  }
}

window.deleteShopItem = async (id) => {
  const pRef = doc(db, 'shopItems', id);
  await deleteDoc(pRef);
  loadShop();
  alert('Item deleted!');
}

saveProductBtn.onclick = async () => {
  const colRef = collection(db, 'shopItems');
  await setDoc(doc(colRef), {
    name: productName.value,
    img: productImg.value,
    cost: Number(productCost.value),
    cashReward: Number(productCashReward.value),
    available: Number(productStock.value)
  });
  loadShop();
  alert('Item added!');
}

loadRooms();
loadShop();

</script>
</body>
</html>
