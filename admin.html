<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin Dashboard ‚Äî NNAMDI</title>
<style>
:root{
  --bg:#f5f6f8; --panel:#fff; --accent:#ff33cc; --muted:#6b7280; --text:#0f1720;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg);color:var(--text);height:100vh;display:flex;overflow:hidden}
.sidebar{width:220px;background:#0b1220;color:#fff;display:flex;flex-direction:column;padding:14px;gap:8px}
.sidebar h2{margin:0 0 6px 0;font-size:16px;text-align:center}
.sidebar button{background:none;border:none;color:#cbd5e1;padding:10px;border-radius:8px;text-align:left;cursor:pointer}
.sidebar button.active, .sidebar button:hover{background:var(--accent);color:#fff}
.main{flex:1;display:flex;flex-direction:column;overflow:hidden}
.topbar{height:64px;background:var(--panel);display:flex;align-items:center;justify-content:space-between;padding:0 18px;border-bottom:1px solid #e6e9ee}
.topbar .left{display:flex;align-items:center;gap:12px}
.brand{font-weight:700}
.admin-info{display:flex;gap:12px;align-items:center;font-size:14px}
.content{display:flex;flex:1;overflow:auto;padding:18px;gap:18px}
.col{flex:1;min-width:420px;max-width:1200px;overflow:auto}
.card{background:var(--panel);border-radius:10px;padding:12px;box-shadow:0 6px 18px rgba(8,12,20,0.06);margin-bottom:12px}
h3{margin:0 0 8px 0}
input,select,textarea{width:100%;padding:8px;border-radius:6px;border:1px solid #e3e7ee;margin:6px 0;font-size:14px}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:8px;border-bottom:1px solid #eef2f6;text-align:left;font-size:13px;vertical-align:middle}
.btn{background:var(--accent);color:#fff;border:none;padding:7px 10px;border-radius:8px;cursor:pointer}
.btn.ghost{background:transparent;color:var(--muted);border:1px solid #eef2f6}
.controls{display:flex;gap:8px;flex-wrap:wrap}
.small{font-size:13px;color:var(--muted)}
.log-list, .claims-list{max-height:360px;overflow:auto;padding:0;margin:0;list-style:none}
.actions-wrap{display:flex;gap:6px;flex-wrap:wrap}
.footer{font-size:12px;color:var(--muted);text-align:center;padding:10px}
.badge{background:#eef2f6;color:#111;padding:4px 6px;border-radius:6px;font-size:12px}

/* ---------- Modal ---------- */
.modal-bg{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;z-index:1000}
.modal{background:#fff;padding:20px;border-radius:10px;min-width:300px;max-width:400px;text-align:center}
.modal h4{margin-bottom:12px}
.modal button{margin:6px}
</style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
  <h2>ADMIN</h2>
  <button data-view="rooms" class="active" onclick="navigate(event)">Rooms</button>
  <button data-view="users" onclick="navigate(event)">Users</button>
  <button data-view="shop" onclick="navigate(event)">Shop</button>
  <button data-view="claims" onclick="navigate(event)">Claims</button>
  <button data-view="logs" onclick="navigate(event)">Logs</button>
  <div style="flex:1"></div>
  <button data-view="meta" onclick="navigate(event)">Admin Profile</button>
</div>

<div class="main">
  <div class="topbar">
    <div class="left">
      <div class="brand">üéõÔ∏è Admin Dashboard</div>
      <div class="small">PC layout ‚Äî realtime</div>
    </div>
    <div class="admin-info">
      <div id="adminDisplay" class="small">Not signed (admin)</div>
      <div id="adminBalances" class="small badge">‚≠ê 0 ‚Äî ‚Ç¶0</div>
      <button class="btn" onclick="refreshAll()">Refresh</button>
    </div>
  </div>

  <div class="content">

    <!-- USERS -->
    <div id="view-users" class="col">
      <div class="card">
        <h3>Users</h3>
        <div style="display:flex;gap:8px;margin-bottom:8px">
          <input id="userSearch" placeholder="Search email / name / id">
          <select id="userFilter">
            <option value="all">All</option>
            <option value="hosts">Hosts</option>
            <option value="vip">VIP</option>
            <option value="banned">Banned</option>
            <option value="kicked">Kicked</option>
            <option value="timedout">Timed out</option>
          </select>
          <button class="btn" id="userSearchBtn">Search</button>
        </div>

        <table class="table">
          <thead><tr><th>User</th><th>Host</th><th>Stars</th><th>Cash</th><th>Status</th><th>Invited By</th><th>Phone</th><th>Actions</th></tr></thead>
          <tbody id="userList"></tbody>
        </table>
      </div>

      <div class="card">
        <h3>Quick Gift / Timeout</h3>
        <div style="display:flex;gap:8px">
          <input id="selectedUserId" placeholder="User id (click a user to auto-fill)">
          <input id="giftStars" type="number" placeholder="Stars">
          <input id="giftCash" type="number" placeholder="Cash">
          <button class="btn" id="quickGiftBtn">Give</button>
        </div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="timeoutSec" type="number" placeholder="Timeout seconds">
          <button class="btn" id="quickTimeoutBtn">Timeout</button>
          <button class="btn ghost" id="quickClearTimeoutBtn">Clear Timeout</button>
        </div>
      </div>
    </div>

  </div>

  <div class="footer">Built for NNAMDI ‚Äî Secure Firestore rules before production.</div>
</div>

<!-- Modal -->
<div class="modal-bg" id="modalBg">
  <div class="modal" id="modalContent">
    <h4 id="modalMessage"></h4>
    <button id="modalConfirm" class="btn">Confirm</button>
    <button id="modalCancel" class="btn ghost">Cancel</button>
  </div>
</div>

<!-- Firebase + JS -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, doc, getDoc, getDocs, setDoc, updateDoc, addDoc, deleteDoc, onSnapshot, increment, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ---------- FIREBASE CONFIG ---------- */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_BUCKET",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ---------- DOM refs ---------- */
const userList = document.getElementById('userList');
const userSearch = document.getElementById('userSearch');
const userFilter = document.getElementById('userFilter');
const selectedUserId = document.getElementById('selectedUserId');
const giftStars = document.getElementById('giftStars');
const giftCash = document.getElementById('giftCash');
const timeoutSec = document.getElementById('timeoutSec');
const userSearchBtn = document.getElementById('userSearchBtn');
const quickGiftBtn = document.getElementById('quickGiftBtn');
const quickTimeoutBtn = document.getElementById('quickTimeoutBtn');
const quickClearTimeoutBtn = document.getElementById('quickClearTimeoutBtn');

const modalBg = document.getElementById('modalBg');
const modalMessage = document.getElementById('modalMessage');
const modalConfirm = document.getElementById('modalConfirm');
const modalCancel = document.getElementById('modalCancel');

let users = [];
let pendingAction = null;

/* ---------- Navigation ---------- */
function navigate(e){
  const view = e.currentTarget?.dataset?.view || e;
  document.querySelectorAll('.col').forEach(c=>c.style.display='none');
  document.getElementById('view-' + view).style.display = 'block';
  document.querySelectorAll('.sidebar button').forEach(b=>b.classList.remove('active'));
  const btn = [...document.querySelectorAll('.sidebar button')].find(b=>b.dataset.view===view);
  if(btn) btn.classList.add('active');
}
window.navigate = navigate;

/* ---------- Modal ---------- */
function showModal(msg, confirmCb){
  modalMessage.textContent = msg;
  pendingAction = confirmCb;
  modalBg.style.display = 'flex';
}
modalConfirm.onclick = ()=>{if(pendingAction) pendingAction(); modalBg.style.display='none'; pendingAction=null;}
modalCancel.onclick = ()=>{modalBg.style.display='none'; pendingAction=null;}

/* ---------- FETCH USERS ---------- */
const usersRef = collection(db,'users');
function renderUsers(){
  const f = userFilter.value;
  const s = userSearch.value.toLowerCase();
  userList.innerHTML = '';
  users.filter(u=>{
    if(f==='vip' && u.status!=='vip') return false;
    if(f==='hosts' && !u.host) return false;
    if(f==='banned' && u.status!=='banned') return false;
    if(f==='kicked' && u.status==='kicked') return false;
    if(f==='timedout' && u.status==='timedout') return false;
    if(s && !(`${u.name} ${u.email} ${u.id}`.toLowerCase().includes(s))) return false;
    return true;
  }).forEach(u=>{
    const tr = document.createElement('tr');
    tr.classList.add('user-row');
    tr.innerHTML=`
      <td>${u.name}<br><span class="small">${u.email}</span></td>
      <td>${u.host?'Yes':'No'}</td>
      <td>${u.stars||0}</td>
      <td>‚Ç¶${u.cash||0}</td>
      <td>${u.status||'active'}</td>
      <td>${u.invitedBy||'-'}</td>
      <td>${u.phone||'-'}</td>
      <td class="actions-wrap">
        <button class="btn ghost" onclick="confirmAction('kick','${u.id}')">Kick</button>
        <button class="btn ghost" onclick="confirmAction('ban','${u.id}')">Ban</button>
        <button class="btn ghost" onclick="confirmAction('timeout','${u.id}')">Timeout</button>
        <button class="btn ghost" onclick="confirmAction('toggleHost','${u.id}')">Prom/Demote</button>
      </td>
    `;
    tr.onclick=()=>selectedUserId.value=u.id;
    userList.appendChild(tr);
  });
}

function fetchUsersRealtime(){
  onSnapshot(usersRef, snapshot=>{
    users = snapshot.docs.map(doc=>({...doc.data(), id: doc.id}));
    renderUsers();
  });
}
fetchUsersRealtime();

userSearchBtn.onclick = renderUsers;
userFilter.onchange = renderUsers;

/* ---------- USER ACTIONS ---------- */
function updateUser(userId, updates){
  const docRef = doc(db,'users',userId);
  updateDoc(docRef,updates).catch(console.error);
}

quickGiftBtn.onclick=()=>{
  const uid = selectedUserId.value;
  if(!uid) return alert('Select a user');
  const updates={};
  if(Number(giftStars.value)) updates.stars = increment(Number(giftStars.value));
  if(Number(giftCash.value)) updates.cash = increment(Number(giftCash.value));
  updateUser(uid,updates);
};

quickTimeoutBtn.onclick=()=>{
  const uid = selectedUserId.value;
  if(!uid) return alert('Select a user');
  const time = Number(timeoutSec.value) || 300;
  updateUser(uid,{status:'timedout',timeoutUntil:serverTimestamp()});
};

quickClearTimeoutBtn.onclick=()=>{
  const uid = selectedUserId.value;
  if(!uid) return alert('Select a user');
  updateUser(uid,{status:'active',timeoutUntil:null});
};

window.confirmAction = function(action,userId){
  const user = users.find(u=>u.id===userId);
  if(!user) return;
  let msg='';
  switch(action){
    case 'kick': msg=`Kick ${user.name}?`; break;
    case 'ban': msg=`Ban ${user.name}?`; break;
    case 'timeout': msg=`Timeout ${user.name}?`; break;
    case 'toggleHost': msg=`Toggle host status for ${user.name}?`; break;
  }
  showModal(msg,()=>{
    switch(action){
      case 'kick': updateUser(userId,{status:'kicked'}); break;
      case 'ban': updateUser(userId,{status:'banned'}); break;
      case 'timeout': updateUser(userId,{status:'timedout'}); break;
      case 'toggleHost': updateUser(userId,{host:!user.host}); break;
    }
  });
};

/* ---------- REFRESH ---------- */
window.refreshAll = ()=>fetchUsersRealtime();
</script>
</body>
</html>