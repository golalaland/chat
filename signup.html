<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VIP/Host Signup</title>
<style>
  body {
    margin:0;
    font-family: 'Arial', sans-serif;
    background: linear-gradient(135deg,#ff9a9e,#fad0c4);
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
    padding:1rem;
  }

  .signup-card {
    background:#fff;
    border-radius:24px;
    padding:2rem;
    width:100%;
    max-width:400px;
    color:#333;
    box-shadow:0 8px 24px rgba(0,0,0,0.2);
  }

  .signup-card h2 {
    text-align:center;
    color:#ff6a95;
    margin-bottom:0.5rem;
  }

  .signup-card p {
    text-align:center;
    font-size:0.9rem;
    color:#555;
    margin-bottom:1.5rem;
  }

  .form-group {
    display:flex;
    flex-direction:column;
    margin-bottom:1rem;
  }

  .form-group label {
    margin-bottom:0.3rem;
    font-size:0.85rem;
    font-weight:bold;
    color:#666;
  }

  .form-group input, .form-group select {
    padding:0.8rem 1rem;
    border-radius:50px;
    border:1px solid #ddd;
    font-size:0.95rem;
    outline:none;
    transition:0.3s;
  }

  .form-group input:focus, .form-group select:focus {
    border-color:#ff6a95;
    box-shadow:0 0 8px rgba(255,106,149,0.3);
  }

  .vip-toggle {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:1.5rem;
    font-weight:bold;
    font-size:0.95rem;
  }

  .toggle-btn {
    width:70px;
    height:32px;
    background:#eee;
    border-radius:16px;
    position:relative;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 5px;
  }

  .toggle-btn span.circle {
    width:28px;
    height:28px;
    background:#ff6a95;
    border-radius:50%;
    position:absolute;
    top:2px;
    left:2px;
    transition:0.3s;
  }

  .toggle-btn.on span.circle {
    left:40px;
  }

  .toggle-btn span.label {
    font-size:0.75rem;
    font-weight:bold;
  }

  .toggle-btn span.label.no { color:#f00; }
  .toggle-btn span.label.yes { color:#0a0; }

  .submit-btn {
    width:100%;
    padding:0.9rem;
    border:none;
    border-radius:50px;
    font-weight:bold;
    font-size:1rem;
    color:#fff;
    background:linear-gradient(90deg,#ff6a95,#ff9a9e);
    cursor:pointer;
    transition:0.3s;
    margin-bottom:0.5rem;
  }

  .submit-btn:hover { transform:scale(1.03); }

  .message {
    text-align:center;
    margin-top:0.5rem;
    font-size:0.9rem;
    color:#333;
  }

  @media (max-width:400px){
    .signup-card { padding:1.5rem; }
  }
</style>
</head>
<body>

<div class="signup-card">
  <h2>VIP/Host Signup</h2>
  <p id="host-info">You're in <span id="host-username">HostName</span>'s VIP Tab</p>

  <div class="form-group">
    <label for="name">Name</label>
    <input id="name" type="text" placeholder="Your full name">
  </div>
  <div class="form-group">
    <label for="phone">Phone</label>
    <input id="phone" type="text" placeholder="e.g +2348012345678">
  </div>
  <div class="form-group">
    <label for="email">Email</label>
    <input id="email" type="email" placeholder="you@example.com">
  </div>
  <div class="form-group">
    <label for="gender">Gender</label>
    <select id="gender">
      <option value="">Select gender</option>
      <option value="Female">Female</option>
      <option value="Male">Male</option>
    </select>
  </div>

  <div class="vip-toggle">
    <span>VIP</span>
    <div class="toggle-btn" id="vipToggle">
      <span class="label yes">Yes</span>
      <span class="label no">No</span>
      <span class="circle"></span>
    </div>
  </div>

  <button class="submit-btn" id="submitBtn">Sign Up</button>
  <div class="message" id="message"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDbKz4ef_eUDlCukjmnK38sOwueYuzqoao",
  authDomain: "metaverse-1010.firebaseapp.com",
  projectId: "metaverse-1010",
  storageBucket: "metaverse-1010.appspot.com",
  messagingSenderId: "1044064238233",
  appId: "1:1044064238233:web:2fbdfb811cb0a3ba349608"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Elements
const vipToggle = document.getElementById('vipToggle');
let isVIP = true;
vipToggle.addEventListener('click', ()=> {
  isVIP = !isVIP;
  vipToggle.classList.toggle('on', isVIP);
});

const submitBtn = document.getElementById('submitBtn');
const messageEl = document.getElementById('message');
const hostUsername = new URLSearchParams(window.location.search).get('host') || 'HostName';
document.getElementById('host-username').textContent = hostUsername;

// Form Submit
submitBtn.addEventListener('click', async () => {
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const email = document.getElementById('email').value.trim();
  const gender = document.getElementById('gender').value;

  if(!name || !phone || !email || !gender){
    messageEl.textContent = 'Please fill all fields.';
    return;
  }

  if(!isVIP && gender !== 'Female'){
    messageEl.textContent = 'Only females can sign up as hosts.';
    return;
  }

  const uid = email.replace(/[.#$[\]]/g, ',');
  const userData = {
    displayName: name,
    phone,
    email,
    gender,
    isVIP,
    isHost: !isVIP,
    hostVIP: isVIP ? hostUsername : null,
    hostVIPUsername: isVIP ? hostUsername : null,
    hostFriends: [],
    hostBadge: 'Gold',
    createdAt: serverTimestamp(),
    whitelist: false,
    paymentStatus: 'pending'
  };

  try {
    await setDoc(doc(db,'users',uid), userData, { merge:true });
    messageEl.textContent = 'Signup recorded. Redirecting to payment...';

    // TODO: Paystack integration
    setTimeout(()=>{messageEl.textContent='Payment complete. Redirecting to chat...';}, 2000);

  } catch(err){
    console.error(err);
    messageEl.textContent = 'Error saving signup. Check console.';
  }
});
</script>
</body>
</html>