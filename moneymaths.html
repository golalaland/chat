<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Money Train ‚Äî Local Simulation</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Montserrat:wght@500;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg:#000;
  --card:#111;
  --muted:#aaa;
  --accent:#FF1493;
  --accent-gradient: linear-gradient(90deg,#FF1493,#FF8C00);
  --glass: rgba(255,255,255,0.03);
}

/* Base */
body, html {margin:0;padding:0;height:100%;font-family:'Montserrat',sans-serif;background:var(--bg);color:#fff;display:flex;justify-content:center;}
#appWrapper{width:100%;max-width:480px;display:flex;flex-direction:column;height:100%;position:relative;padding-bottom:120px;}

/* Header */
#gameHeader{text-align:center;margin-top:10px;}
#welcomeText{font-family:'Press Start 2P',cursive;font-size:12px;color:var(--accent);}
#scrambleText{font-family:'Press Start 2P',cursive;font-size:22px;color:var(--accent);margin-top:2px;}

/* Join Train Button */
#joinTrainBtn {display:block;margin:12px auto;padding:12px 20px;border-radius:20px;
  background:linear-gradient(90deg,#FF1493,#FF8C00);color:#fff;font-weight:800;font-size:16px;
  border:none;cursor:pointer;text-shadow:0 0 6px #fff;transition:0.2s;z-index:10;}
#joinTrainBtn[disabled] {opacity:0.45; cursor:not-allowed; transform:none; box-shadow:none;}

/* Loading Bar */
#loadingContainer{width:90%;max-width:480px;margin:10px auto;background:#111;border-radius:12px;overflow:hidden;position:relative;display:none;}
#loadingBar{width:0%;height:16px;background:var(--accent);}
#trainEmoji{position:absolute;left:0;top:-8px;font-size:24px;transition:left 1s linear;}

/* Daily Reward */
#dailyReward{width:90%;max-width:480px;margin:10px auto;background:#222;border-radius:12px;padding:6px;color:var(--accent);text-align:center;font-weight:700;}

/* Problem Blocks */
.scramble-board{text-align:center; margin:10px 0; display:flex; flex-wrap:wrap; justify-content:center; gap:8px;}
.problemInput{width:60px;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.2);
  background:#0e0e0e;color:#fff;text-align:center;font-weight:700;}

/* Submit Button */
#submitAnswers {
  display:none;
  margin:10px auto;
  padding:10px 20px;
  border:none;
  border-radius:10px;
  background:linear-gradient(90deg,#FF1493,#FF8C00);
  color:#fff;
  font-weight:800;
  cursor:pointer;
  transition:0.2s;
}
#submitAnswers:hover {transform:scale(1.03);}

/* Profile Panel */
.profile{position:fixed;bottom:60px;width:100%;max-width:480px;left:0;display:flex;justify-content:center;z-index:99;}
.profile-card{background:var(--glass);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);display:flex;flex-direction:column;gap:6px;text-align:center;}
.profile-name{font-weight:800;font-size:14px;color:var(--accent);}
.profile-info{font-size:12px;color:#fff;}

/* Popup */
.star-popup{position:fixed;left:50%;bottom:140px;transform:translateX(-50%);background:var(--card);padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.05);display:none;z-index:10000;color:var(--accent);font-size:14px;text-align:center;box-shadow:0 6px 24px rgba(0,0,0,0.6);}

/* Confirmation Modal */
.confirm-modal {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  backdrop-filter: blur(4px);
}
.confirm-box {
  background: #000;
  border: 1.5px solid #FF1493;
  border-radius: 12px;
  padding: 14px 18px;
  text-align: center;
  color: white;
  box-shadow: 0 0 10px #FF149380;
  font-family: 'Montserrat', sans-serif;
  font-size: 14px;
  max-width: 320px;
  width: 86%;
}
.confirm-box h3 { font-size:16px; margin-bottom:8px; color:#FF1493; }
.confirm-box p { margin:0; font-size:13px; color:#ddd; }
.confirm-actions { display:flex; justify-content:space-around; margin-top:12px; }
.confirm-actions button { padding:8px 14px; border-radius:7px; border:none; cursor:pointer; font-weight:700; background:linear-gradient(90deg,#FF1493,#FF8C00); color:#fff;}

/* ---------------- Glass Train Terminal ---------------- */
.glass-terminal {
  width: 90%;
  max-width: 420px;
  margin: 20px auto;
  padding: 14px 18px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 14px;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  box-shadow: 0 0 18px rgba(255,20,147,0.18);
  font-family: 'Press Start 2P', cursive;
  color: #FF8C00;
  text-align: left;
  position: relative;
  overflow: hidden;
}
.glass-terminal::before { content:''; position:absolute; top:0; left:0; width:100%; height:100%; border-radius:14px; background:linear-gradient(120deg, rgba(255,20,147,0.18), rgba(255,140,0,0.12)); pointer-events:none; opacity:0.28; }
.terminal-header { text-align:center; color:#FF1493; font-size:10px; letter-spacing:2px; margin-bottom:8px; text-shadow:0 0 8px #FF1493aa; }
.terminal-line { font-size:11px; line-height:1.6; letter-spacing:1px; color:#fff; margin-bottom:4px; display:flex; justify-content:space-between; }
.terminal-line span { color:#00FF99; text-shadow:0 0 6px #00FF99; }

/* Closed overlay styling */
.station-closed {
  text-align:center;
  padding:12px;
  color:#ffddcc;
  background: rgba(0,0,0,0.55);
  border-radius:10px;
  margin-top:8px;
  border:1px dashed #ff7a59;
}

.verify-section {
  text-align: center;
  margin-top: 1.5em;
}

#verifyTicketBtn {
  background: linear-gradient(90deg, #00c853, #b2ff59);
  border: none;
  padding: 12px 20px;
  border-radius: 8px;
  font-size: 16px; /* prevents zoom on iOS */
  color: #000;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.2s ease, opacity 0.3s ease;
}

#verifyTicketBtn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

#verifyTicketBtn:hover:not(:disabled) {
  transform: scale(1.05);
}
/* small helpers */
.hidden { display:none !important; }
</style>
</head>
<body>
<div id="appWrapper">
  <!-- Header -->
  <div id="gameHeader">
    <div id="welcomeText">WELCOME TO</div>
    <div id="scrambleText">MONEY TRAIN üöÇ</div>
  </div>

  <!-- üöâ Train Terminal Display -->
  <div id="trainTerminal" class="train-terminal glass-terminal">
    <div class="terminal-header">TRAIN TERMINAL</div>
    <div class="terminal-line">üöÇ Train Name: <span id="trainName">Money Express</span></div>
    <div class="terminal-line">üìÖ Date: <span id="trainDate"></span></div>
    <div class="terminal-line">‚è∞ Time: <span id="trainTime"></span></div>
    <div class="terminal-line">üìç Destination: <span id="trainDestination">Lagos Central</span></div>

    <!-- closed overlay placeholder -->
    <div id="closedOverlay" class="station-closed hidden">
      üö´ TRAIN STATION CLOSED FOR TODAY<br>
      Reopens in <span id="reopenCountdown">00:00:00</span>
    </div>
  </div>

  <!-- ü™© Confirmation Modal -->
  <div id="confirmModal" class="confirm-modal">
    <div class="confirm-box">
      <h3>Join Train?</h3>
      <p id="confirmText">Are you ready to play and ride the Money Train?</p>
      <div class="confirm-actions">
        <button id="confirmYes">Join</button>
        <button id="confirmNo">Cancel</button>
      </div>
    </div>
  </div>
  
  <audio id="trainWhistle" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_31cb3c7056.mp3?filename=train-whistle-117125.mp3" preload="auto"></audio>
<audio id="trainDepart" src="https://cdn.pixabay.com/download/audio/2021/09/29/audio_9da9a23f6e.mp3?filename=train-departure-81307.mp3" preload="auto"></audio>

  <!-- Daily Reward -->
  <div id="dailyReward">DAILY CASH REWARD: ‚Ç¶<span id="dailyPot">1,000,000</span></div>

  <!-- Join Train Button -->
  <button id="joinTrainBtn">JOIN TRAIN</button>

  <!-- Loading Bar -->
  <div id="loadingContainer">
    <div id="loadingBar"></div>
    <div id="trainEmoji">üöÇ</div>
  </div>

  <!-- Problem Blocks -->
  <div id="problemBoard" class="scramble-board hidden"></div>

  <!-- Submit Answers Button (created dynamically if missing) -->
  <button id="submitAnswers" class="hidden">Submit Answers</button>

<!-- üé´ Verify Ticket Button -->
<div class="verify-section">
  <button id="verifyTicketBtn" disabled>Verify Ticket üé´</button>
</div>

  <!-- Profile Panel -->
  <div class="profile" id="profilePanel">
    <div class="profile-card">
      <div class="profile-name" id="profileName">GUEST 0000</div>
      <div class="profile-info">STARS: <span id="starCount">50</span>‚≠ê</div>
      <div class="profile-info">CASH: ‚Ç¶<span id="cashCount">0</span></div>
    </div>
  </div>
</div>

<!-- Popup -->
<div id="popup" class="star-popup">+1 ‚≠ê</div>

<script>
/* ---------------- READY: Money Train local simulation (fixed submit + ticket) ---------------- */
document.addEventListener('DOMContentLoaded', () => {

  /* ------------- Config ------------- */
  const INITIAL_POT = 1000000; // ‚Ç¶1,000,000 start
  const DEDUCT_PER_WIN = 1000;  // ‚Ç¶1,000 per win (taken from pot)
  const REWARD_TO_USER = 1000;  // ‚Ç¶1,000 reward to user per win
  const STARS_PER_WIN = 5 * 8;  // 40 stars (5 * NUM_BLOCKS)
  const NUM_BLOCKS = 8;
  const STAR_COST = 10; // cost in stars to join each train (enforced)

  /* ------------- UI Refs ------------- */
  const joinTrainBtn = document.getElementById('joinTrainBtn');
  const loadingContainer = document.getElementById('loadingContainer');
  const loadingBar = document.getElementById('loadingBar');
  const trainEmoji = document.getElementById('trainEmoji');
  const problemBoard = document.getElementById('problemBoard');
  const submitAnswersBtn = document.getElementById('submitAnswers');
  const popup = document.getElementById('popup');
  const dailyPotEl = document.getElementById('dailyPot');
  const closedOverlay = document.getElementById('closedOverlay');
  const reopenCountdown = document.getElementById('reopenCountdown');
  const confirmModal = document.getElementById('confirmModal');
  const confirmYes = document.getElementById('confirmYes');
  const confirmNo = document.getElementById('confirmNo');
  const confirmText = document.getElementById('confirmText');

  const profileNameEl = document.getElementById('profileName');
  const starCountEl = document.getElementById('starCount');
  const cashCountEl = document.getElementById('cashCount');
  const trainDestinationEl = document.getElementById('trainDestination');

  /* ------------- Sound Hooks ------------- */
  function playSound(name, loop=false){
    try {
      const a = new Audio(`./sounds/${name}.mp3`);
      a.volume = 0.7;
      a.loop = loop;
      a.play().catch(()=>{ /* ignore play errors */ });
      return a;
    } catch (e){
      return null;
    }
  }

  /* ------------- Local State & Persistence ------------- */
  let loadingInterval = null;
  let loadingProgress = 0;
  let trainActive = false;
  let currentProblems = [];

  // storage helpers
  function getStoredPot(){
    const raw = localStorage.getItem('moneytrain_pot');
    return raw ? parseInt(raw,10) : null;
  }
  function setStoredPot(v){
    localStorage.setItem('moneytrain_pot', String(Math.max(0, Math.floor(v))));
    updatePotUI();
  }
  function getHalfAlertDate(){ return localStorage.getItem('moneytrain_half_date') || null; }
  function setHalfAlertDate(s){ localStorage.setItem('moneytrain_half_date', s); }
  function getPotResetDay(){ return localStorage.getItem('moneytrain_reset_day') || null; }
  function setPotResetDay(s){ localStorage.setItem('moneytrain_reset_day', s); }

  function initializePot(){
    const today = new Date().toISOString().slice(0,10);
    const resetDay = getPotResetDay();
    if (!getStoredPot() || resetDay !== today){
      setStoredPot(INITIAL_POT);
      setPotResetDay(today);
      setHalfAlertDate('');
    }
  }

  function updatePotUI(){
    const pot = getStoredPot() ?? INITIAL_POT;
    dailyPotEl.textContent = pot.toLocaleString();
    if (pot <= 0){
      handleStationClosed();
    } else {
      if (!closedOverlay.classList.contains('hidden') && !isPastMidnightReset()){
        closedOverlay.classList.add('hidden');
        joinTrainBtn.disabled = false;
        joinTrainBtn.style.opacity = '1';
      }
    }
  }

  /* ------------- Terminal helpers ------------- */
  const trainNames = ["Money Express","Starliner 9000","Frenzy Rail","Lucky Cargo","Fortune Flyer","Crypto Cruiser","Golden Dash","Midnight Ride"];
  const destinations = ["Lagos","Accra","Nairobi","Cape Town","Johannesburg","Abuja","Kigali","London","Dubai","New York"];

  function setTrainTerminal(){
    const name = trainNames[Math.floor(Math.random()*trainNames.length)];
    const dest = destinations[Math.floor(Math.random()*destinations.length)];
    const date = new Date().toLocaleDateString('en-GB', { weekday:'short', day:'2-digit', month:'short', year:'numeric' });
    const elName = document.getElementById('trainName');
    const elDate = document.getElementById('trainDate');
    const elDest = document.getElementById('trainDestination');
    if (elName) elName.textContent = name;
    if (elDate) elDate.textContent = date;
    if (elDest) elDest.textContent = dest;
    if (confirmText) confirmText.textContent = `Join ${name} ‚Üí ${dest}? Ready to play?`;
  }

  function updateTrainTime(){ const now = new Date(); const timeEl = document.getElementById('trainTime'); if (timeEl) timeEl.textContent = now.toLocaleTimeString('en-GB',{hour12:false}); }

  /* ------------- Popup helper ------------- */
  let popupTimeout = null;
  function showPopup(text, ms=4500){
    popup.textContent = text;
    popup.style.display = 'block';
    popup.style.opacity = '1';
    if (popupTimeout) clearTimeout(popupTimeout);
    popupTimeout = setTimeout(()=>{
      popup.style.opacity = '0';
      setTimeout(()=>{ popup.style.display = 'none'; }, 300);
    }, ms);
  }

  /* ------------- Halfway alert (once per day) ------------- */
  function maybeShowHalfwayAlert(){
    const pot = getStoredPot() ?? INITIAL_POT;
    const half = Math.floor(INITIAL_POT/2);
    const today = new Date().toISOString().slice(0,10);
    const shownDate = getHalfAlertDate();
    if (pot <= half && shownDate !== today){
      setHalfAlertDate(today);
      showPopup('‚ö†Ô∏è Halfway Mined! The pot is running low ‚Äî hurry!', 6000);
      const terminal = document.getElementById('trainTerminal');
      if (terminal){
        terminal.style.boxShadow = '0 0 30px rgba(255,165,0,0.28)';
        setTimeout(()=>{ terminal.style.boxShadow = ''; }, 2500);
      }
    }
  }

  /* ------------- Station closed / reopen countdown ------------- */
  let countdownTimer = null;
  function timeToNextMidnight(){ const now = new Date(); const tomorrow = new Date(now); tomorrow.setDate(now.getDate()+1); tomorrow.setHours(0,0,0,0); return Math.max(0, tomorrow - now); }
  function formatHMS(ms){ const s = Math.floor(ms/1000); const hh = String(Math.floor(s/3600)).padStart(2,'0'); const mm = String(Math.floor((s%3600)/60)).padStart(2,'0'); const ss = String(s%60).padStart(2,'0'); return `${hh}:${mm}:${ss}`; }

  function handleStationClosed(){
    closedOverlay.classList.remove('hidden');
    joinTrainBtn.disabled = true;
    joinTrainBtn.style.display = 'block';
    joinTrainBtn.style.opacity = '0.5';
    if (countdownTimer) clearInterval(countdownTimer);
    function tick(){
      const ms = timeToNextMidnight();
      reopenCountdown.textContent = formatHMS(ms);
      if (ms <= 0){
        clearInterval(countdownTimer);
        resetPotAndReopen();
      }
    }
    tick();
    countdownTimer = setInterval(tick, 1000);
    playSound('train_depart');
  }

  function resetPotAndReopen(){
    setStoredPot(INITIAL_POT);
    const today = new Date().toISOString().slice(0,10);
    setPotResetDay(today);
    setHalfAlertDate('');
    closedOverlay.classList.add('hidden');
    joinTrainBtn.disabled = false;
    joinTrainBtn.style.opacity = '1';
    setTrainTerminal();
    updatePotUI();
    showPopup('üîÅ Pot reset! Station reopened.', 3500);
  }

  function isPastMidnightReset(){ const today = new Date().toISOString().slice(0,10); return getPotResetDay() !== today; }

  /* ------------- Problems generator ------------- */
  function generateProblems(){
    currentProblems = [];
    problemBoard.innerHTML = '';
    for(let i=0;i<NUM_BLOCKS;i++){
      let a = Math.floor(Math.random()*20)+1;
      let b = Math.floor(Math.random()*20)+1;
      if (a < b) [a,b] = [b,a];
      currentProblems.push({a,b,ans:a+b});

      const wrapper = document.createElement('div');
      wrapper.style.display = 'flex';
      wrapper.style.flexDirection = 'column';
      wrapper.style.alignItems = 'center';
      wrapper.style.gap = '6px';
      wrapper.style.margin = '6px';

      const label = document.createElement('div');
      label.textContent = `${a} + ${b}`;
      label.style.fontWeight = '700';
      label.style.fontSize = '12px';
      label.style.color = '#fff';

      const input = document.createElement('input');
      input.type = 'number';
      input.className = 'problemInput';
      input.placeholder = '?';
      input.style.width = '60px';
      input.style.padding = '6px';
      input.style.borderRadius = '6px';
      input.style.border = '1px solid rgba(255,255,255,0.12)';
      input.style.background = '#0e0e0e';
      input.style.color = '#fff';
      input.style.textAlign = 'center';
      input.dataset.index = i;

      wrapper.appendChild(label);
      wrapper.appendChild(input);
      problemBoard.appendChild(wrapper);
    }
  }

const verifyBtn = document.getElementById('verifyTicketBtn');
const inputs = document.querySelectorAll('.problemInput');
const whistle = document.getElementById('trainWhistle');
const depart = document.getElementById('trainDepart');

let dailyPot = 1000000; // ‚Ç¶1,000,000 for local simulation

inputs.forEach(inp => {
  inp.addEventListener('input', () => {
    const allFilled = Array.from(inputs).every(i => i.value.trim() !== '');
    verifyBtn.disabled = !allFilled;
  });
});

verifyBtn.addEventListener('click', () => {
  let correct = true;
  let ticketNumber = '';

  inputs.forEach((inp, i) => {
    const val = parseInt(inp.value);
    ticketNumber += val;
    if (val !== currentProblems[i].ans) correct = false;
  });

  if (!correct) {
    showPopup("‚ö†Ô∏è You‚Äôre not yet done hashing your train ticket, hurry!");
    return;
  }

  const reward = Math.floor(Math.random() * 5000) + 1000; // ‚Ç¶1,000‚Äì‚Ç¶6,000
  const destination = document.getElementById('trainDestination').textContent;

  // üéµ Play whistle
  whistle.currentTime = 0;
  whistle.play();

  setTimeout(() => {
    showPopup(`üé´ You‚Äôve secured your ${destination} train ticket number ${ticketNumber}! You‚Äôve earned ‚Ç¶${reward}!`);
  }, 500);

  dailyPot -= reward;

  if (dailyPot <= 0) {
    // üéµ Train leaves sound
    depart.currentTime = 0;
    depart.play();

    setTimeout(() => {
      showPopup("üö´ Train Station Closed for Today! Check back tomorrow.");
      document.getElementById('joinTrainBtn').disabled = true;
      verifyBtn.disabled = true;
    }, 2000);
  }
});

  /* ------------- Loading (countdown until train leaves) ------------- */
  function startLoadingBar(){
    loadingContainer.style.display = 'block';
    loadingProgress = 0;
    loadingBar.style.width = '0%';
    trainEmoji.style.left = '0px';
    loadingInterval = setInterval(()=>{
      loadingProgress++;
      const percent = (loadingProgress/39) * 100; // 39 seconds
      loadingBar.style.width = `${percent}%`;
      trainEmoji.style.left = `calc(${percent}% - 12px)`;
      if (loadingProgress >= 39){
        clearInterval(loadingInterval);
        loadingInterval = null;
        if (trainActive){
          trainActive = false;
          stopLoadingBar();
          playSound('train_depart');
          // if loading expired while user still solving -> fail
          endTrain(false);
        }
      }
    }, 1000);
  }

  function stopLoadingBar(){
    if (loadingInterval) { clearInterval(loadingInterval); loadingInterval = null; }
    loadingContainer.style.display = 'none';
    loadingBar.style.width = '0%';
    trainEmoji.style.left = '0px';
  }

  /* ------------- Start / End Train flow ------------- */
  function startTrain(){
    // ensure station open
    if ((getStoredPot() ?? INITIAL_POT) <= 0) {
      showPopup('üöß Station closed for today. Come back tomorrow.');
      return;
    }

    // star check
    const curStars = parseInt(starCountEl.textContent,10) || 0;
    if (curStars < STAR_COST){
      showPopup('Not enough stars to join.');
      return;
    }

    // deduct star cost
    starCountEl.textContent = (curStars - STAR_COST);

    // set state
    trainActive = true;

    // UI: hide join, show problems & submit button (use direct style to avoid class conflicts)
    joinTrainBtn.style.display = 'none';
    generateProblems();
    problemBoard.classList.remove('hidden');
    submitAnswersBtn.style.display = 'block';

    // start loading timer + sound
    startLoadingBar();
    playSound('train_start');
  }

  function endTrain(success, ticketNumber=null){
    stopLoadingBar();

    // hide problems & submit
    problemBoard.classList.add('hidden');
    submitAnswersBtn.style.display = 'none';

    // show join again only if pot still > 0
    if ((getStoredPot() ?? INITIAL_POT) > 0) {
      joinTrainBtn.style.display = 'block';
      joinTrainBtn.disabled = false;
      joinTrainBtn.style.opacity = '1';
    } else {
      joinTrainBtn.style.display = 'block';
      joinTrainBtn.disabled = true;
      joinTrainBtn.style.opacity = '0.5';
    }

    if (success){
      // Reward user: update cash and stars
      const oldCash = parseInt(cashCountEl.textContent.replace(/,/g,''),10) || 0;
      const newCash = oldCash + REWARD_TO_USER;
      cashCountEl.textContent = newCash.toLocaleString();

      const oldStars = parseInt(starCountEl.textContent,10) || 0;
      const newStars = oldStars + STARS_PER_WIN;
      starCountEl.textContent = newStars;

      // deduct from pot
      let pot = getStoredPot() ?? INITIAL_POT;
      pot = Math.max(0, pot - DEDUCT_PER_WIN);
      setStoredPot(pot);

      // ticket message: show destination and ticket number
      const dest = trainDestinationEl?.textContent || 'your destination';
      const tnum = ticketNumber || '---';
      showPopup(`üé´ You‚Äôve secured your ${dest} train ticket number ${tnum} ‚Äî welcome aboard! You earned ‚Ç¶${REWARD_TO_USER.toLocaleString()}!`, 6000);
      playSound('cha_ching');

      maybeShowHalfwayAlert();

      if (pot <= 0){
        handleStationClosed();
      }
    } else {
      showPopup('Train left! You got nothing üò¢', 2200);
    }
  }

  /* ------------- Submit handler (checks all 8 answers + creates ticket) ------------- */
  submitAnswersBtn.addEventListener('click', () => {
    if (!trainActive) return;

    const inputs = Array.from(document.querySelectorAll('.problemInput'));
    // check empties:
    const anyEmpty = inputs.some(inp => inp.value === '' || inp.value === null);
    if (anyEmpty){
      showPopup("You're not yet done hashing your train ticket ‚Äî hurry!", 3000);
      playSound('error_bell');
      return;
    }

    // evaluate correctness
    let allCorrect = true;
    inputs.forEach((inp, i) => {
      const val = parseInt(inp.value,10);
      const expected = currentProblems[i].ans;
      if (isNaN(val) || val !== expected) allCorrect = false;
    });

    // stop timer
    trainActive = false;
    stopLoadingBar();

    if (allCorrect){
      // build ticket number by concatenating each answer's string (in order)
      const answers = inputs.map(inp => String(parseInt(inp.value,10)));
      const ticketNumber = answers.join('');
      // success flow -> we pass ticketNumber to endTrain to display message
      endTrain(true, ticketNumber);
    } else {
      showPopup("Some answers are incorrect ‚Äî train left!", 3000);
      playSound('train_depart');
      endTrain(false);
    }
  });

  /* ------------- Join button + modal wiring ------------- */
  joinTrainBtn.addEventListener('click', () => {
    if (joinTrainBtn.disabled) return;
    confirmModal.style.display = 'flex';
    playSound('train_whistle_short');
  });
  confirmYes.addEventListener('click', () => { confirmModal.style.display = 'none'; startTrain(); });
  confirmNo.addEventListener('click', () => { confirmModal.style.display = 'none'; });

  /* ------------- Init & timers ------------- */
  function init(){
    initializePot();
    updatePotUI();
    setTrainTerminal();
    setInterval(setTrainTerminal, 60000);
    setInterval(updateTrainTime, 1000);
    updateTrainTime();
    maybeShowHalfwayAlert();
    problemBoard.classList.add('hidden');
    submitAnswersBtn.style.display = 'none';

    // schedule midnight reset
    const msToMid = timeToNextMidnight();
    setTimeout(()=>{ resetPotAndReopen(); }, msToMid + 1000);
    setInterval(()=>{ if (isPastMidnightReset()){ resetPotAndReopen(); } }, 60_000);
  }

  init();

  // Expose debug helpers
  window.moneyTrainLocal = {
    getPot: () => getStoredPot(),
    setPot: (v) => setStoredPot(v),
    resetPotAndReopen,
    simulateWin: () => { trainActive = true; generateProblems(); endTrain(true,'TEST-TICKET'); }
  };

}); // DOMContentLoaded end
</script>
</body>
</html>