<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Money Train</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Montserrat:wght@500;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg:#000;
  --card:#111;
  --muted:#aaa;
  --accent:#FF1493;
  --accent-gradient: linear-gradient(90deg,#FF1493,#FF8C00);
  --glass: rgba(255,255,255,0.03);
}

/* Base */
body, html {margin:0;padding:0;height:100%;font-family:'Montserrat',sans-serif;background:var(--bg);color:#fff;display:flex;justify-content:center;}
#appWrapper{width:100%;max-width:480px;display:flex;flex-direction:column;height:100%;position:relative;}

/* Header */
#gameHeader{text-align:center;margin-top:10px;}
#welcomeText{font-family:'Press Start 2P',cursive;font-size:12px;color:var(--accent);}
#scrambleText{font-family:'Press Start 2P',cursive;font-size:22px;color:var(--accent);margin-top:2px;}

/* Join Train Button */
#joinTrainBtn {display:block;margin:20px auto;padding:12px 20px;border-radius:20px;
  background:linear-gradient(90deg,#FF1493,#FF8C00);color:#fff;font-weight:800;font-size:16px;
  border:none;cursor:pointer;text-shadow:0 0 6px #fff;transition:0.3s;}
#joinTrainBtn:hover {transform:scale(1.05);box-shadow:0 0 15px #FF1493;}

/* Loading Bar */
#loadingContainer{width:90%;max-width:480px;margin:10px auto;background:#111;border-radius:12px;overflow:hidden;position:relative;display:none;}
#loadingBar{width:0%;height:16px;background:var(--accent);}
#trainEmoji{position:absolute;left:0;top:-8px;font-size:24px;transition:left 1s linear;}

/* Daily Reward */
#dailyReward{width:90%;max-width:480px;margin:10px auto;background:#222;border-radius:12px;padding:6px;color:var(--accent);text-align:center;font-weight:700;}

/* Problem Blocks */
.scramble-board{text-align:center; margin:10px 0; display:flex; flex-wrap:wrap; justify-content:center; gap:8px;}
.problemInput{width:60px;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.2);
  background:#0e0e0e;color:#fff;text-align:center;font-weight:700;}

/* Submit Button */
#submitAnswers {
  display:none;
  margin:10px auto;
  padding:10px 20px;
  border:none;
  border-radius:10px;
  background:linear-gradient(90deg,#FF1493,#FF8C00);
  color:#fff;
  font-weight:800;
  cursor:pointer;
  transition:0.3s;
}
#submitAnswers:hover {transform:scale(1.05);}

/* Profile Panel */
.profile{position:fixed;bottom:60px;width:100%;max-width:480px;left:0;display:flex;justify-content:center;z-index:99;}
.profile-card{background:var(--glass);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);display:flex;flex-direction:column;gap:6px;text-align:center;}
.profile-name{font-weight:800;font-size:14px;color:var(--accent);}
.profile-info{font-size:12px;color:#fff;}

/* Star popup */
.star-popup{position:fixed;left:50%;top:20%;transform:translateX(-50%);background:var(--card);padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.05);display:none;z-index:1000;color:var(--accent);font-size:13px;text-align:center;}

/* Confirmation Modal */
.confirm-modal {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.7);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  backdrop-filter: blur(4px);
}
.confirm-box {
  background: #000;
  border: 1.5px solid #FF1493;
  border-radius: 12px;
  padding: 16px 22px;
  text-align: center;
  color: white;
  box-shadow: 0 0 10px #FF149380;
  font-family: 'Montserrat', sans-serif;
  font-size: 14px;
  max-width: 300px;
  width: 80%;
}
.confirm-box h3 {
  font-size: 16px;
  margin-bottom: 10px;
  color: #FF1493;
}
.confirm-actions {
  display: flex;
  justify-content: space-around;
  margin-top: 15px;
}
.confirm-actions button {
  padding: 8px 16px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  background: linear-gradient(90deg,#FF1493,#FF8C00);
  color: #fff;
  transition: 0.2s ease;
}
.confirm-actions button:hover {
  transform: scale(1.05);
  opacity: 0.9;
}

/* ---------------- Glass Train Terminal ---------------- */
.glass-terminal {
  width: 90%;
  max-width: 420px;
  margin: 20px auto;
  padding: 16px 20px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 16px;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  box-shadow: 0 0 25px rgba(255,20,147,0.25);
  font-family: 'Press Start 2P', cursive;
  color: #FF8C00;
  text-align: left;
  position: relative;
  overflow: hidden;
}

/* glowing edge strip */
.glass-terminal::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: 16px;
  background: linear-gradient(120deg, rgba(255,20,147,0.25), rgba(255,140,0,0.25));
  pointer-events: none;
  opacity: 0.3;
}

/* flicker title */
.terminal-header {
  text-align: center;
  color: #FF1493;
  font-size: 10px;
  letter-spacing: 2px;
  margin-bottom: 10px;
  text-shadow: 0 0 10px #FF1493aa;
  animation: headerGlow 2.5s ease-in-out infinite alternate;
}
@keyframes headerGlow {
  from { text-shadow: 0 0 5px #FF8C00; }
  to { text-shadow: 0 0 15px #FF1493; }
}

/* info lines */
.terminal-line {
  font-size: 9px;
  line-height: 1.6;
  letter-spacing: 1px;
  color: #fff;
  margin-bottom: 4px;
  display: flex;
  justify-content: space-between;
  animation: subtleBlink 5s infinite;
}
.terminal-line span {
  color: #00FF99;
  text-shadow: 0 0 6px #00FF99;
}
@keyframes subtleBlink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.97; }
}
</style>
</head>

<body>
<div id="appWrapper">
  <!-- Header -->
  <div id="gameHeader">
    <div id="welcomeText">WELCOME TO</div>
    <div id="scrambleText">MONEY TRAIN üöÇ</div>
  </div>
  
  <!-- üöâ Train Terminal Display -->
  <div id="trainTerminal" class="train-terminal glass-terminal">
    <div class="terminal-header">TRAIN TERMINAL</div>
    <div class="terminal-line">üöÇ Train Name: <span id="trainName">Money Express</span></div>
    <div class="terminal-line">üìÖ Date: <span id="trainDate"></span></div>
    <div class="terminal-line">‚è∞ Time: <span id="trainTime"></span></div>
    <div class="terminal-line">üìç Destination: <span id="trainDestination">Lagos Central</span></div>
  </div>

  <!-- ü™© Confirmation Modal -->
  <div id="confirmModal" class="confirm-modal">
    <div class="confirm-box">
      <h3>Join Train?</h3>
      <p>Are you ready to play and ride the Money Train?</p>
      <div class="confirm-actions">
        <button id="confirmYes">Join</button>
        <button id="confirmNo">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Daily Reward -->
  <div id="dailyReward">DAILY CASH REWARD: ‚Ç¶<span id="dailyPot">1,000,000</span></div>

  <!-- Join Train Button -->
  <button id="joinTrainBtn">JOIN TRAIN</button>

  <!-- Loading Bar -->
  <div id="loadingContainer">
    <div id="loadingBar"></div>
    <div id="trainEmoji">üöÇ</div>
  </div>

  <!-- Problem Blocks -->
  <div id="problemBoard" class="scramble-board" style="display:none;"></div>

  <!-- Submit Answers Button -->
  <button id="submitAnswers">Submit Answers</button>

  <!-- Profile Panel -->
  <div class="profile" id="profilePanel">
    <div class="profile-card">
      <div class="profile-name" id="profileName">GUEST 0000</div>
      <div class="profile-info">STARS: <span id="starCount">50</span>‚≠ê</div>
      <div class="profile-info">CASH: ‚Ç¶<span id="cashCount">0</span></div>
    </div>
  </div>
</div>

<!-- Star popup -->
<div class="star-popup" id="starPopup">+1 ‚≠ê</div>

<script>
// ----- Full fixed script ----- 
document.addEventListener('DOMContentLoaded', () => {

  /* ---------------- Sample User Data ---------------- */
  let currentUser = {
    uid: 'guest001',        // change when real user logs in
    name: 'GUEST 0000',
    stars: 50,
    cash: 0
  };

  const starCost = 10; // internal cost

  // UI refs (guarded)
  const joinTrainBtn = document.getElementById('joinTrainBtn');
  const problemBoard = document.getElementById('problemBoard');
  const loadingBar = document.getElementById('loadingBar');
  const trainEmoji = document.getElementById('trainEmoji');
  const starPopup = document.getElementById('starPopup');
  const dailyPotEl = document.getElementById('dailyPot');
  const confirmModal = document.getElementById('confirmModal');
  const confirmYes = document.getElementById('confirmYes');
  const confirmNo = document.getElementById('confirmNo');

  const profileNameEl = document.getElementById('profileName');
  const starCountEl = document.getElementById('starCount');
  const cashCountEl = document.getElementById('cashCount');

  if (!joinTrainBtn || !problemBoard || !loadingBar || !trainEmoji || !starPopup || !dailyPotEl || !confirmModal || !confirmYes || !confirmNo) {
    console.error('One or more required elements are missing from the DOM. Check ids.');
    return;
  }

  // write initial profile info
  if (profileNameEl) profileNameEl.textContent = currentUser.name;
  if (starCountEl) starCountEl.textContent = currentUser.stars;
  if (cashCountEl) cashCountEl.textContent = currentUser.cash;

  /* ---------------- Globals ---------------- */
  const NUM_BLOCKS = 8;
  let currentProblems = [];
  let loadingInterval = null;
  let loadingProgress = 0;
  let trainActive = false;

  /* ---------------- Helpers ---------------- */
  function showStarPopup(text){
    starPopup.textContent = text;
    starPopup.style.display = 'block';
    setTimeout(()=>{ starPopup.style.display = 'none'; }, 1500);
  }

  function createOrGetSubmitButton(){
    let btn = document.getElementById('submitAnswers');
    if (!btn) {
      btn = document.createElement('button');
      btn.id = 'submitAnswers';
      btn.textContent = 'Submit Answers';
      // apply minimal inline style (you can keep CSS in file)
      btn.style.display = 'none';
      btn.style.margin = '10px auto';
      btn.style.padding = '10px 20px';
      btn.style.borderRadius = '10px';
      btn.style.border = 'none';
      btn.style.cursor = 'pointer';
      btn.style.background = 'linear-gradient(90deg,#FF1493,#FF8C00)';
      btn.style.color = '#fff';
      btn.style.fontWeight = '800';
      // append below problem board
      problemBoard.insertAdjacentElement('afterend', btn);
    }
    return btn;
  }

  /* ---------------- Problems ---------------- */
  function generateProblems(){
    currentProblems = [];
    problemBoard.innerHTML = '';
    for(let i=0;i<NUM_BLOCKS;i++){
      let a = Math.floor(Math.random()*20)+1;
      let b = Math.floor(Math.random()*20)+1;
      if(a < b) [a,b] = [b,a];
      currentProblems.push({a,b,ans:a+b});

      const wrapper = document.createElement('div');
      wrapper.style.display = 'flex';
      wrapper.style.flexDirection = 'column';
      wrapper.style.alignItems = 'center';
      wrapper.style.gap = '6px';
      wrapper.style.margin = '6px';

      const label = document.createElement('div');
      label.textContent = `${a} + ${b}`;
      label.style.fontWeight = '700';
      label.style.fontSize = '12px';
      label.style.color = '#fff';

      const input = document.createElement('input');
      input.type = 'number';
      input.className = 'problemInput';
      input.placeholder = '?';
      input.style.width = '60px';
      input.style.padding = '6px';
      input.style.borderRadius = '6px';
      input.style.border = '1px solid rgba(255,255,255,0.12)';
      input.style.background = '#0e0e0e';
      input.style.color = '#fff';
      input.style.textAlign = 'center';
      input.dataset.index = i;

      wrapper.appendChild(label);
      wrapper.appendChild(input);
      problemBoard.appendChild(wrapper);
    }
  }

  /* ---------------- Loading Bar ---------------- */
  function startLoadingBar(){
    // show loading container if hidden
    const loadingContainer = document.getElementById('loadingContainer');
    if (loadingContainer) loadingContainer.style.display = 'block';

    loadingProgress = 0;
    loadingBar.style.width = '0%';
    trainEmoji.style.left = '0px';
    loadingInterval = setInterval(()=>{
      loadingProgress++;
      const percent = (loadingProgress/39)*100;
      loadingBar.style.width = `${percent}%`;
      // place emoji with small offset so it doesn't overflow container
      trainEmoji.style.left = `calc(${percent}% - 12px)`;
      if(loadingProgress >= 39){
        clearInterval(loadingInterval);
        loadingInterval = null;
        trainActive = false;
        endTrain(false); // train left
      }
    },1000);
  }

  function stopLoadingBar(){
    if (loadingInterval) {
      clearInterval(loadingInterval);
      loadingInterval = null;
    }
    const loadingContainer = document.getElementById('loadingContainer');
    if (loadingContainer) loadingContainer.style.display = 'none';
  }

  /* ---------------- Train Logic ---------------- */
  function startTrain(){
    // star check
    if(currentUser.stars < starCost){
      showStarPopup("Not enough stars!");
      return;
    }

    // deduct star and update UI
    currentUser.stars -= starCost;
    if (starCountEl) starCountEl.textContent = currentUser.stars;

    // prepare game UI
    generateProblems();
    problemBoard.style.display = 'flex';
    // show submit button (created dynamically if missing)
    const submitBtn = createOrGetSubmitButton();
    submitBtn.style.display = 'block';

    // hide join button to give space for gameplay
    joinTrainBtn.style.display = 'none';

    // change appearance state
    trainActive = true;
    // start loading bar (the timed train departure)
    startLoadingBar();
  }

  /* ---------------- End Train ---------------- */
  function endTrain(success){
    stopLoadingBar();
    problemBoard.style.display = 'none';
    // hide submit button
    const submitBtn = document.getElementById('submitAnswers');
    if (submitBtn) submitBtn.style.display = 'none';

    // restore join button (but hide if user is logged in and you want it hidden)
    // If you want join button permanently hidden for logged-in users, change the condition below
    if (currentUser.uid === 'guest001') {
      joinTrainBtn.style.display = 'block';
    } else {
      // hide for logged-in users if desired:
      joinTrainBtn.style.display = 'none';
    }

    // reset appearance
    joinTrainBtn.textContent = 'Join Train';
    joinTrainBtn.style.background = 'linear-gradient(90deg,#FF1493,#FF8C00)';

    if(success){
      // reward calculation consistent with old logic
      const rewardStars = 5 * NUM_BLOCKS;
      const rewardCash = 50 * NUM_BLOCKS;
      currentUser.stars += rewardStars;
      currentUser.cash += rewardCash;
      if (starCountEl) starCountEl.textContent = currentUser.stars;
      if (cashCountEl) cashCountEl.textContent = currentUser.cash;
      // update daily pot element (add rewardCash to pot OR subtract depending on your desired behavior)
      // Original code added reward to daily pot; if you want mining model instead, implement elsewhere.
      if (dailyPotEl) dailyPotEl.textContent = parseInt(dailyPotEl.textContent) + rewardCash;
      showStarPopup(`+${rewardStars}‚≠ê +‚Ç¶${rewardCash}`);
    } else {
      showStarPopup("Train left! You got nothing üò¢");
    }
  }

  /* ---------------- Button + Modal Logic ---------------- */
  // single listener for joinTrainBtn
  joinTrainBtn.addEventListener('click', () => {
    if (trainActive) {
      // safety: should not happen because join button is hidden when trainActive; but keep fallback:
      const inputs = document.querySelectorAll('.problemInput');
      let correct = true;
      inputs.forEach((inp, i) => {
        if (parseInt(inp.value) !== currentProblems[i].ans) correct = false;
      });
      stopLoadingBar();
      trainActive = false;
      endTrain(correct);
    } else {
      // open modal
      confirmModal.style.display = 'flex';
      // optionally: populate modal with dynamic train/destination info:
      const tn = document.getElementById('trainName')?.textContent || '';
      const dest = document.getElementById('trainDestination')?.textContent || '';
      const modalP = confirmModal.querySelector('p');
      if (modalP) modalP.textContent = `Join ${tn} ‚Üí ${dest}? Ready to play?`;
    }
  });

  confirmYes.addEventListener('click', () => {
    confirmModal.style.display = 'none';
    startTrain();
  });

  confirmNo.addEventListener('click', () => {
    confirmModal.style.display = 'none';
  });

  /* ---------------- Submit Answers button handling ---------------- */
  const submitBtn = createOrGetSubmitButton();
  submitBtn.addEventListener('click', () => {
    // user clicks submit, validate answers
    if (!trainActive) return;
    const inputs = document.querySelectorAll('.problemInput');
    let correct = true;
    inputs.forEach((inp, i) => {
      // if empty treat as wrong
      const val = parseInt(inp.value);
      if (isNaN(val) || val !== currentProblems[i].ans) correct = false;
    });

    // stop timer & end train
    stopLoadingBar();
    trainActive = false;
    endTrain(correct);
  });

  /* ---------------- Train Terminal (time/name/dest) ---------------- */
  const trainNames = ["Money Express","Starliner 9000","Frenzy Rail","Lucky Cargo","Fortune Flyer","Crypto Cruiser","Golden Dash","Midnight Ride"];
  const destinations = ["Lagos","Accra","Nairobi","Cape Town","Johannesburg","Abuja","Kigali","London","Dubai","New York"];

  function setTrainTerminal(){
    const name = trainNames[Math.floor(Math.random()*trainNames.length)];
    const dest = destinations[Math.floor(Math.random()*destinations.length)];
    const date = new Date().toLocaleDateString('en-GB', { weekday:'short', day:'2-digit', month:'short', year:'numeric' });
    const elName = document.getElementById('trainName');
    const elDate = document.getElementById('trainDate');
    const elDest = document.getElementById('trainDestination');
    if (elName) elName.textContent = name;
    if (elDate) elDate.textContent = date;
    if (elDest) elDest.textContent = dest;
  }

  function updateTrainTime(){
    const now = new Date();
    const timeEl = document.getElementById('trainTime');
    if (timeEl) timeEl.textContent = now.toLocaleTimeString('en-GB',{hour12:false});
  }

  setTrainTerminal();
  setInterval(setTrainTerminal, 60000);
  setInterval(updateTrainTime, 1000);
  updateTrainTime();

  /* ---------------- Hide / show join by login state ---------------- */
  function updateJoinVisibilityByLogin(){
    // hide join button for logged in users (you can change logic)
    if (currentUser.uid && currentUser.uid !== 'guest001') {
      joinTrainBtn.style.display = 'none';
    } else {
      joinTrainBtn.style.display = 'block';
    }
  }
  updateJoinVisibilityByLogin();

  // export some helpers to window for testing if needed
  window.__moneyTrain = {
    currentUser,
    generateProblems,
    startTrain,
    endTrain,
    setTrainTerminal,
    updateTrainTime
  };

}); // DOMContentLoaded end
</script>
</body>
</html>