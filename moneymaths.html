<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Money Maths Game</title>
<link rel="icon" href="data:," />
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#000;
  --card:#111;
  --muted:#aaa;
  --accent:#FF1493;
  --glass: rgba(255,255,255,0.03);
}
body, html {margin:0; padding:0; height:100%; font-family: 'Inter', sans-serif; background: var(--bg); color:#fff; display:flex; justify-content:center;}
#appWrapper{width:100%; max-width:480px; display:flex; flex-direction:column; height:100%; position:relative;}
#gameHeader {text-align:center; margin-top:10px;}
#welcomeText{font-family:'Press Start 2P', cursive; font-size:12px; color:var(--accent);}
#scrambleText{font-family:'Press Start 2P', cursive; font-size:22px; color:var(--accent); margin-top:2px;}
#rulesBtn {display:block; margin:6px auto; padding:6px 12px; border-radius:12px; background:var(--card); border:1px solid rgba(255,20,147,0.2); color:var(--accent); font-weight:700; cursor:pointer;}
#wordMarquee {width:100%; overflow:hidden; white-space:nowrap; display:block; border-top:1px solid rgba(255,255,255,0.1); border-bottom:1px solid rgba(255,255,255,0.1); padding:4px 0; margin-bottom:6px; color:var(--accent); font-size:12px;}
#wordMarquee span {margin-right:12px; display:inline-block;}
.scramble-board {text-align:center; margin:8px 0;}
#expressions {font-family:'Press Start 2P', cursive; font-size:18px; letter-spacing:3px; color:#fff; display:flex; flex-direction:column; gap:4px;}
#messages {flex:1; overflow-y:auto; padding:8px; display:flex; flex-direction:column; gap:6px;}
.send-area {position:fixed; bottom:0; left:0; width:100%; max-width:480px; display:flex; align-items:center; gap:8px; background:var(--card); padding:10px; border-radius:999px; box-sizing:border-box; z-index:100;}
.send-area input {flex:1; padding:12px 16px; border-radius:999px; border:1px solid rgba(255,255,255,0.08); background-color:#0e0e0e; color:#fff; font-size:16px; outline:none;}
.buzz-btn {padding:10px; border-radius:999px; background:#000; border:1px solid var(--accent); color:var(--accent); font-weight:700; font-size:16px; cursor:pointer; animation: flicker 2s infinite alternate;}
@keyframes flicker {0%{opacity:1;}50%{opacity:0.6;}100%{opacity:1;}}
.profile {position:fixed; bottom:60px; width:100%; max-width:480px; left:0; display:flex; justify-content:center; z-index:99;}
.profile-card {background:var(--glass); padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); display:flex; flex-direction:column; gap:6px; text-align:center;}
.profile-name {font-weight:800; font-size:14px; color:var(--accent);}
.profile-info {font-size:12px; color:#fff;}
.star-popup{position:fixed;left:50%;top:20%;transform:translateX(-50%);background:var(--card);padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.05);display:none;z-index:1000;color:var(--accent);font-size:13px;text-align:center;}
#countdown {text-align:center; font-size:14px; color:var(--accent); margin-top:6px; display:none;}
</style>
</head>
<body>
<div id="appWrapper">
  <div id="gameHeader">
    <div id="welcomeText">WELCOME TO</div>
    <div id="scrambleText">MONEY MATHS üí∞</div>
  </div>

  <button id="rulesBtn">Rules</button>
  <div id="wordMarquee"></div>

  <div class="scramble-board">
    <div id="expressions"></div>
  </div>

  <div id="messages"></div>
  <div id="countdown"></div>

  <div class="send-area">
    <input type="text" id="buzzInput" placeholder="Buzz cumulative answer...">
    <button id="buzzBtn" class="buzz-btn">üö®</button>
  </div>

  <div class="profile" id="profilePanel">
    <div class="profile-card">
      <div class="profile-name" id="profileName">GUEST 0000</div>
      <div class="profile-info">STARS COLLECTED: <span id="starCount">0</span>‚≠êÔ∏è</div>
      <div class="profile-info">CASH EARNED: ‚Ç¶<span id="cashCount">0</span></div>
    </div>
  </div>
</div>

<div class="star-popup" id="starPopup">+1 ‚≠ê</div>

<script>
let currentUser = { uid:'guest001', name:'GUEST 0000', stars:100, cash:0 };
document.getElementById('profileName').textContent = currentUser.name;
document.getElementById('starCount').textContent = currentUser.stars;
document.getElementById('cashCount').textContent = currentUser.cash;

const MAX_ENTRIES = 53;
const BUZZ_COST = 5;
const REWARD_STARS = 20;
const REWARD_CASH = 50;
const SESSION_TIME = 60; // seconds
let entriesCount = 0;
let currentSession = null;
let cooldownTimer = null;
const submittedAnswers = new Set();

const expressionsEl = document.getElementById('expressions');
const buzzInput = document.getElementById('buzzInput');
const messagesEl = document.getElementById('messages');
const starPopup = document.getElementById('starPopup');
const wordMarquee = document.getElementById('wordMarquee');
const countdownEl = document.getElementById('countdown');

function showStarPopup(text){
  starPopup.textContent = text;
  starPopup.style.display = "block";
  setTimeout(()=>starPopup.style.display="none",1500);
}

function getRandomInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

function generateSession(){
  let problems=[], cumulative=0;
  for(let i=0;i<8;i++){
    const a=getRandomInt(1,20);
    const b=getRandomInt(1,20);
    const op = Math.random()<0.5?"+":"-";
    const answer = op==="+"? a+b : a-b;
    cumulative+=answer;
    problems.push({expr:`${a} ${op} ${b}`, answer});
  }
  currentSession={problems, cumulative: cumulative.toString(), entries:0};
  entriesCount=0;
  expressionsEl.innerHTML=problems.map(p=>p.expr).join("<br>");
  countdownEl.style.display="block";
  let timer=SESSION_TIME;
  countdownEl.textContent=`Time left: ${timer}s`;
  clearInterval(cooldownTimer);
  cooldownTimer=setInterval(()=>{
    timer--;
    countdownEl.textContent=`Time left: ${timer}s`;
    if(timer<=0){
      clearInterval(cooldownTimer);
      startCooldown();
    }
  },1000);
}

function startCooldown(minutes=5){
  expressionsEl.innerHTML="";
  countdownEl.style.display="block";
  let timer=minutes*60;
  cooldownTimer=setInterval(()=>{
    timer--;
    const min=Math.floor(timer/60);
    const sec=timer%60;
    countdownEl.textContent=`Next session in ${min}:${sec<10?'0'+sec:sec}`;
    if(timer<=0){
      clearInterval(cooldownTimer);
      generateSession();
    }
  },1000);
}

function handleBuzz(){
  if(entriesCount>=MAX_ENTRIES){
    showStarPopup("Session full! Wait for next session.");
    return;
  }
  if(currentUser.stars<BUZZ_COST){
    showStarPopup("Not enough stars to buzz!");
    return;
  }
  const input=buzzInput.value.trim();
  if(!input){ showStarPopup("Enter cumulative answer!"); return; }
  currentUser.stars-=BUZZ_COST;
  entriesCount++;
  if(input===currentSession.cumulative){
    currentUser.stars+=REWARD_STARS;
    currentUser.cash+=REWARD_CASH;
    showStarPopup(`üéâ Correct! +${REWARD_STARS}‚≠ê & ‚Ç¶${REWARD_CASH}`);
    const span=document.createElement("span");
    span.textContent=currentSession.problems.map(p=>p.expr).join(", ") + " = "+currentSession.cumulative;
    wordMarquee.appendChild(span);
  } else showStarPopup("‚ùå Wrong answer!");

  document.getElementById('starCount').textContent=currentUser.stars;
  document.getElementById('cashCount').textContent=currentUser.cash;

  const msg=document.createElement('div');
  msg.textContent=currentUser.name+": "+input + (input===currentSession.cumulative?" ‚úÖ":" ‚ùå");
  messagesEl.appendChild(msg);
  messagesEl.scrollTop=messagesEl.scrollHeight;

  buzzInput.value="";
  if(entriesCount>=MAX_ENTRIES) startCooldown();
}

document.getElementById('buzzBtn').addEventListener('click',handleBuzz);
document.getElementById('rulesBtn').addEventListener('click',()=>{
  alert(`üéÆ Money Maths Rules:
- 8 vertical math problems per session.
- Input cumulative answer in one go.
- Each buzz costs ${BUZZ_COST}‚≠ê.
- Correct gives +${REWARD_STARS}‚≠ê and +‚Ç¶${REWARD_CASH}.
- Max ${MAX_ENTRIES} correct entries per session.
- 60 seconds per session, new session after cooldown.`);
});

generateSession();
</script>
</body>
</html>